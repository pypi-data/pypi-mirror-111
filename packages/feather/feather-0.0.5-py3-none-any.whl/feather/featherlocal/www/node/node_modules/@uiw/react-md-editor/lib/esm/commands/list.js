import * as React from 'react';
import { selectWord, getBreaksNeededForEmptyLineBefore, getBreaksNeededForEmptyLineAfter } from '../utils/markdownUtils';

/**
 * Inserts insertionString before each line
 */
export function insertBeforeEachLine(selectedText, insertBefore) {
  var lines = selectedText.split(/\n/);
  var insertionLength = 0;
  var modifiedText = lines.map(function (item, index) {
    if (typeof insertBefore === 'string') {
      insertionLength += insertBefore.length;
      return insertBefore + item;
    } else if (typeof insertBefore === 'function') {
      var insertionResult = insertBefore(item, index);
      insertionLength += insertionResult.length;
      return insertBefore(item, index) + item;
    }

    throw Error('insertion is expected to be either a string or a function');
  }).join('\n');
  return {
    modifiedText: modifiedText,
    insertionLength: insertionLength
  };
}
export var makeList = function makeList(state, api, insertBefore) {
  // Adjust the selection to encompass the whole word if the caret is inside one
  var newSelectionRange = selectWord({
    text: state.text,
    selection: state.selection
  });
  var state1 = api.setSelectionRange(newSelectionRange);
  var breaksBeforeCount = getBreaksNeededForEmptyLineBefore(state1.text, state1.selection.start);
  var breaksBefore = Array(breaksBeforeCount + 1).join('\n');
  var breaksAfterCount = getBreaksNeededForEmptyLineAfter(state1.text, state1.selection.end);
  var breaksAfter = Array(breaksAfterCount + 1).join('\n');
  var modifiedText = insertBeforeEachLine(state1.selectedText, insertBefore);
  api.replaceSelection("".concat(breaksBefore).concat(modifiedText.modifiedText).concat(breaksAfter)); // Specifically when the text has only one line, we can exclude the "- ", for example, from the selection

  var oneLinerOffset = state1.selectedText.indexOf('\n') === -1 ? modifiedText.insertionLength : 0;
  var selectionStart = state1.selection.start + breaksBeforeCount + oneLinerOffset;
  var selectionEnd = selectionStart + modifiedText.modifiedText.length - oneLinerOffset; // Adjust the selection to not contain the **

  api.setSelectionRange({
    start: selectionStart,
    end: selectionEnd
  });
};
export var unorderedListCommand = {
  name: 'unordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+l',
  buttonProps: {
    'aria-label': 'Add unordered list',
    title: 'Add unordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "unordered-list",
    width: "12",
    height: "12",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, '- ');
  }
};
export var orderedListCommand = {
  name: 'ordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+o',
  buttonProps: {
    'aria-label': 'Add ordered list',
    title: 'Add ordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "ordered-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M3.263 139.527c0-7.477 3.917-11.572 11.573-11.572h15.131V88.078c0-5.163.534-10.503.534-10.503h-.356s-1.779 2.67-2.848 3.738c-4.451 4.273-10.504 4.451-15.666-1.068l-5.518-6.231c-5.342-5.341-4.984-11.216.534-16.379l21.72-19.938C32.815 33.602 36.732 32 42.785 32H54.89c7.656 0 11.749 3.916 11.749 11.572v84.384h15.488c7.655 0 11.572 4.094 11.572 11.572v8.901c0 7.477-3.917 11.572-11.572 11.572H14.836c-7.656 0-11.573-4.095-11.573-11.572v-8.902zM2.211 304.591c0-47.278 50.955-56.383 50.955-69.165 0-7.18-5.954-8.755-9.28-8.755-3.153 0-6.479 1.051-9.455 3.852-5.079 4.903-10.507 7.004-16.111 2.451l-8.579-6.829c-5.779-4.553-7.18-9.805-2.803-15.409C13.592 201.981 26.025 192 47.387 192c19.437 0 44.476 10.506 44.476 39.573 0 38.347-46.753 46.402-48.679 56.909h39.049c7.529 0 11.557 4.027 11.557 11.382v8.755c0 7.354-4.028 11.382-11.557 11.382h-67.94c-7.005 0-12.083-4.028-12.083-11.382v-4.028zM5.654 454.61l5.603-9.28c3.853-6.654 9.105-7.004 15.584-3.152 4.903 2.101 9.63 3.152 14.359 3.152 10.155 0 14.358-3.502 14.358-8.23 0-6.654-5.604-9.106-15.934-9.106h-4.728c-5.954 0-9.28-2.101-12.258-7.88l-1.05-1.926c-2.451-4.728-1.226-9.806 2.801-14.884l5.604-7.004c6.829-8.405 12.257-13.483 12.257-13.483v-.35s-4.203 1.051-12.608 1.051H16.685c-7.53 0-11.383-4.028-11.383-11.382v-8.755c0-7.53 3.853-11.382 11.383-11.382h58.484c7.529 0 11.382 4.027 11.382 11.382v3.327c0 5.778-1.401 9.806-5.079 14.183l-17.509 20.137c19.611 5.078 28.716 20.487 28.716 34.845 0 21.363-14.358 44.126-48.503 44.126-16.636 0-28.192-4.728-35.896-9.455-5.779-4.202-6.304-9.805-2.626-15.934zM144 132h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "".concat(index + 1, ". ");
    });
  }
};
export var checkedListCommand = {
  name: 'checked-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+c',
  buttonProps: {
    'aria-label': 'Add checked list',
    title: 'Add checked list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "checked-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M208 132h288c8.8 0 16-7.2 16-16V76c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zM64 368c-26.5 0-48.6 21.5-48.6 48s22.1 48 48.6 48 48-21.5 48-48-21.5-48-48-48zm92.5-299l-72.2 72.2-15.6 15.6c-4.7 4.7-12.9 4.7-17.6 0L3.5 109.4c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.3c4.7-4.7 12.3-4.7 17 0l17 16.5c4.6 4.7 4.6 12.3-.1 17zm0 159.6l-72.2 72.2-15.7 15.7c-4.7 4.7-12.9 4.7-17.6 0L3.5 269c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.7c4.7-4.7 12.3-4.7 17 0l17 17c4.6 4.6 4.6 12.2-.1 16.9z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "- [ ] ";
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tYW5kcy9saXN0LnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsInNlbGVjdFdvcmQiLCJnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVCZWZvcmUiLCJnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVBZnRlciIsImluc2VydEJlZm9yZUVhY2hMaW5lIiwic2VsZWN0ZWRUZXh0IiwiaW5zZXJ0QmVmb3JlIiwibGluZXMiLCJzcGxpdCIsImluc2VydGlvbkxlbmd0aCIsIm1vZGlmaWVkVGV4dCIsIm1hcCIsIml0ZW0iLCJpbmRleCIsImxlbmd0aCIsImluc2VydGlvblJlc3VsdCIsIkVycm9yIiwiam9pbiIsIm1ha2VMaXN0Iiwic3RhdGUiLCJhcGkiLCJuZXdTZWxlY3Rpb25SYW5nZSIsInRleHQiLCJzZWxlY3Rpb24iLCJzdGF0ZTEiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImJyZWFrc0JlZm9yZUNvdW50Iiwic3RhcnQiLCJicmVha3NCZWZvcmUiLCJBcnJheSIsImJyZWFrc0FmdGVyQ291bnQiLCJlbmQiLCJicmVha3NBZnRlciIsInJlcGxhY2VTZWxlY3Rpb24iLCJvbmVMaW5lck9mZnNldCIsImluZGV4T2YiLCJzZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvbkVuZCIsInVub3JkZXJlZExpc3RDb21tYW5kIiwibmFtZSIsImtleUNvbW1hbmQiLCJzaG9ydGN1dHMiLCJidXR0b25Qcm9wcyIsInRpdGxlIiwiaWNvbiIsImV4ZWN1dGUiLCJvcmRlcmVkTGlzdENvbW1hbmQiLCJjaGVja2VkTGlzdENvbW1hbmQiXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBS0EsS0FBWixNQUF1QixPQUF2QjtBQUVBLFNBQ0VDLFVBREYsRUFFRUMsaUNBRkYsRUFHRUMsZ0NBSEYsUUFJTyx3QkFKUDs7QUFRQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNDLG9CQUFULENBQ0xDLFlBREssRUFFTEMsWUFGSyxFQUc4QztBQUNuRCxNQUFNQyxLQUFL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QUMsRUFBQztBQUZKLElBREYsQ0FOd0M7QUFhMUNDLEVBQUFBLE9BQU8sRUFBRSxpQkFBQzFCLEtBQUQsRUFBbUJDLEdBQW5CLEVBQTRDO0FBQ25ERixJQUFBQSxRQUFRLENBQUNDLEtBQUQsRUFBUUMsR0FBUixFQUFhLFVBQUNSLElBQUQsRUFBT0MsS0FBUDtBQUFBLHVCQUFvQkEsS0FBSyxHQUFHLENBQTVCO0FBQUEsS0FBYixDQUFSO0FBQ0Q7QUFmeUMsQ0FBckM7QUFrQlAsT0FBTyxJQUFNa0Msa0JBQTRCLEdBQUc7QUFDMUNSLEVBQUFBLElBQUksRUFBRSxjQURvQztBQUUxQ0MsRUFBQUEsVUFBVSxFQUFFLE1BRjhCO0FBRzFDQyxFQUFBQSxTQUFTLEVBQUUsY0FIK0I7QUFJMUNDLEVBQUFBLFdBQVcsRUFBRTtBQUFFLGtCQUFjLGtCQUFoQjtBQUFvQ0MsSUFBQUEsS0FBSyxFQUFFO0FBQTNDLEdBSjZCO0FBSzFDQyxFQUFBQSxJQUFJLGVBQ0Y7QUFBSyxpQkFBVSxjQUFmO0FBQThCLElBQUEsS0FBSyxFQUFDLElBQXBDO0FBQXlDLElBQUEsTUFBTSxFQUFDLElBQWhEO0FBQXFELElBQUEsSUFBSSxFQUFDLEtBQTFEO0FBQWdFLElBQUEsT0FBTyxFQUFDO0FBQXhFLGtCQUNFO0FBQ0UsSUFBQSxJQUFJLEVBQUMsY0FEUDtBQUVFLElBQUEsQ0FBQyxFQUFDO0FBRkosSUFERixDQU53QztBQWExQ0MsRUFBQUEsT0FBTyxFQUFFLGlCQUFDMUIsS0FBRCxFQUFtQkMsR0FBbkIsRUFBNEM7QUFDbkRGLElBQUFBLFFBQVEsQ0FBQ0MsS0FBRCxFQUFRQyxHQUFSLEVBQWEsVUFBQ1IsSUFBRCxFQUFPQyxLQUFQO0FBQUE7QUFBQSxLQUFiLENBQVI7QUFDRDtBQWZ5QyxDQUFyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IElDb21tYW5kLCBUZXh0U3RhdGUsIFRleHRBcmVhVGV4dEFwaSB9IGZyb20gJy4vJztcbmltcG9ydCB7XG4gIHNlbGVjdFdvcmQsXG4gIGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUJlZm9yZSxcbiAgZ2V0QnJlYWtzTmVlZGVkRm9yRW1wdHlMaW5lQWZ0ZXIsXG59IGZyb20gJy4uL3V0aWxzL21hcmtkb3duVXRpbHMnO1xuXG5leHBvcnQgdHlwZSBBbHRlckxpbmVGdW5jdGlvbiA9IChsaW5lOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpID0+IHN0cmluZztcblxuLyoqXG4gKiBJbnNlcnRzIGluc2VydGlvblN0cmluZyBiZWZvcmUgZWFjaCBsaW5lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRCZWZvcmVFYWNoTGluZShcbiAgc2VsZWN0ZWRUZXh0OiBzdHJpbmcsXG4gIGluc2VydEJlZm9yZTogc3RyaW5nIHwgQWx0ZXJMaW5lRnVuY3Rpb24sXG4pOiB7IG1vZGlmaWVkVGV4dDogc3RyaW5nOyBpbnNlcnRpb25MZW5ndGg6IG51bWJlciB9IHtcbiAgY29uc3QgbGluZXMgPSBzZWxlY3RlZFRleHQuc3BsaXQoL1xcbi8pO1xuXG4gIGxldCBpbnNlcnRpb25MZW5ndGggPSAwO1xuICBjb25zdCBtb2RpZmllZFRleHQgPSBsaW5lc1xuICAgIC5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGluc2VydEJlZm9yZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW5zZXJ0aW9uTGVuZ3RoICs9IGluc2VydEJlZm9yZS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBpbnNlcnRCZWZvcmUgKyBpdGVtO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5zZXJ0QmVmb3JlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnN0IGluc2VydGlvblJlc3VsdCA9IGluc2VydEJlZm9yZShpdGVtLCBpbmRleCk7XG4gICAgICAgIGluc2VydGlvbkxlbmd0aCArPSBpbnNlcnRpb25SZXN1bHQubGVuZ3RoO1xuICAgICAgICByZXR1cm4gaW5zZXJ0QmVmb3JlKGl0ZW0sIGluZGV4KSArIGl0ZW07XG4gICAgICB9XG4gICAgICB0aHJvdyBFcnJvcignaW5zZXJ0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIGVpdGhlciBhIHN0cmluZyBvciBhIGZ1bmN0aW9uJyk7XG4gICAgfSlcbiAgICAuam9pbignXFxuJyk7XG5cbiAgcmV0dXJuIHsgbW9kaWZpZWRUZXh0LCBpbnNlcnRpb25MZW5ndGggfTtcbn1cblxuZXhwb3J0IGNvbnN0IG1ha2VMaXN0ID0gKHN0YXRlOiBUZXh0U3RhdGUsIGFwaTogVGV4dEFyZWFUZXh0QXBpLCBpbnNlcnRCZWZvcmU6IHN0cmluZyB8IEFsdGVyTGluZUZ1bmN0aW9uKSA9PiB7XG4gIC8vIEFkanVzdCB0aGUgc2VsZWN0aW9uIHRvIGVuY29tcGFzcyB0aGUgd2hvbGUgd29yZCBpZiB0aGUgY2FyZXQgaXMgaW5zaWRlIG9uZVxuICBjb25zdCBuZXdTZWxlY3Rpb25SYW5nZSA9IHNlbGVjdFdvcmQoeyB0ZXh0OiBzdGF0ZS50ZXh0LCBzZWxlY3Rpb246IHN0YXRlLnNlbGVjdGlvbiB9KTtcbiAgY29uc3Qgc3RhdGUxID0gYXBpLnNldFNlbGVjdGlvblJhbmdlKG5ld1NlbGVjdGlvblJhbmdlKTtcblxuICBjb25zdCBicmVha3NCZWZvcmVDb3VudCA9IGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUJlZm9yZShzdGF0ZTEudGV4dCwgc3RhdGUxLnNlbGVjdGlvbi5zdGFydCk7XG4gIGNvbnN0IGJyZWFrc0JlZm9yZSA9IEFycmF5KGJyZWFrc0JlZm9yZUNvdW50ICsgMSkuam9pbignXFxuJyk7XG5cbiAgY29uc3QgYnJlYWtzQWZ0ZXJDb3VudCA9IGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUFmdGVyKHN0YXRlMS50ZXh0LCBzdGF0ZTEuc2VsZWN0aW9uLmVuZCk7XG4gIGNvbnN0IGJyZWFrc0FmdGVyID0gQXJyYXkoYnJlYWtzQWZ0ZXJDb3VudCArIDEpLmpvaW4oJ1xcbicpO1xuXG4gIGNvbnN0IG1vZGlmaWVkVGV4dCA9IGluc2VydEJlZm9yZUVhY2hMaW5lKHN0YXRlMS5zZWxlY3RlZFRleHQsIGluc2VydEJlZm9yZSk7XG5cbiAgYXBpLnJlcGxhY2VTZWxlY3Rpb24oYCR7YnJlYWtzQmVmb3JlfSR7bW9kaWZpZWRUZXh0Lm1vZGlmaWVkVGV4dH0ke2JyZWFrc0FmdGVyfWApO1xuXG4gIC8vIFNwZWNpZmljYWxseSB3aGVuIHRoZSB0ZXh0IGhhcyBvbmx5IG9uZSBsaW5lLCB3ZSBjYW4gZXhjbHVkZSB0aGUgXCItIFwiLCBmb3IgZXhhbXBsZSwgZnJvbSB0aGUgc2VsZWN0aW9uXG4gIGNvbnN0IG9uZUxpbmVyT2Zmc2V0ID0gc3RhdGUxLnNlbGVjdGVkVGV4dC5pbmRleE9mKCdcXG4nKSA9PT0gLTEgPyBtb2RpZmllZFRleHQuaW5zZXJ0aW9uTGVuZ3RoIDogMDtcblxuICBjb25zdCBzZWxlY3Rpb25TdGFydCA9IHN0YXRlMS5zZWxlY3Rpb24uc3RhcnQgKyBicmVha3NCZWZvcmVDb3VudCArIG9uZUxpbmVyT2Zmc2V0O1xuICBjb25zdCBzZWxlY3Rpb25FbmQgPSBzZWxlY3Rpb25TdGFydCArIG1vZGlmaWVkVGV4dC5tb2RpZmllZFRleHQubGVuZ3RoIC0gb25lTGluZXJPZmZzZXQ7XG5cbiAgLy8gQWRqdXN0IHRoZSBzZWxlY3Rpb24gdG8gbm90IGNvbnRhaW4gdGhlICoqXG4gIGFwaS5zZXRTZWxlY3Rpb25SYW5nZSh7XG4gICAgc3RhcnQ6IHNlbGVjdGlvblN0YXJ0LFxuICAgIGVuZDogc2VsZWN0aW9uRW5kLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCB1bm9yZGVyZWRMaXN0Q29tbWFuZDogSUNvbW1hbmQgPSB7XG4gIG5hbWU6ICd1bm9yZGVyZWQtbGlzdCcsXG4gIGtleUNvbW1hbmQ6ICdsaXN0JyxcbiAgc2hvcnRjdXRzOiAnY3RybCtzaGlmdCtsJyxcbiAgYnV0dG9uUHJvcHM6IHsgJ2FyaWEtbGFiZWwnOiAnQWRkIHVub3JkZXJlZCBsaXN0JywgdGl0bGU6ICdBZGQgdW5vcmRlcmVkIGxpc3QnIH0sXG4gIGljb246IChcbiAgICA8c3ZnIGRhdGEtbmFtZT1cInVub3JkZXJlZC1saXN0XCIgd2lkdGg9XCIxMlwiIGhlaWdodD1cIjEyXCIgdmlld0JveD1cIjAgMCA1MTIgNTEyXCI+XG4gICAgICA8cGF0aFxuICAgICAgICBmaWxsPVwiY3VycmVudENvbG9yXCJcbiAgICAgICAgZD1cIk05NiA5NmMwIDI2LjUxLTIxLjQ5IDQ4LTQ4IDQ4UzAgMTIyLjUxIDAgOTZzMjEuNDktNDggNDgtNDggNDggMjEuNDkgNDggNDh6TTQ4IDIwOGMtMjYuNTEgMC00OCAyMS40OS00OCA0OHMyMS40OSA0OCA0OCA0OCA0OC0yMS40OSA0OC00OC0yMS40OS00OC00OC00OHptMCAxNjBjLTI2LjUxIDAtNDggMjEuNDktNDggNDhzMjEuNDkgNDggNDggNDggNDgtMjEuNDkgNDgtNDgtMjEuNDktNDgtNDgtNDh6bTk2LTIzNmgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNlY3NmMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2em0wIDE2MGgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNnYtNDBjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6XCJcbiAgICAgIC8+XG4gICAgPC9zdmc+XG4gICksXG4gIGV4ZWN1dGU6IChzdGF0ZTogVGV4dFN0YXRlLCBhcGk6IFRleHRBcmVhVGV4dEFwaSkgPT4ge1xuICAgIG1ha2VMaXN0KHN0YXRlLCBhcGksICctICcpO1xuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IG9yZGVyZWRMaXN0Q29tbWFuZDogSUNvbW1hbmQgPSB7XG4gIG5hbWU6ICdvcmRlcmVkLWxpc3QnLFxuICBrZXlDb21tYW5kOiAnbGlzdCcsXG4gIHNob3J0Y3V0czogJ2N0cmwrc2hpZnQrbycsXG4gIGJ1dHRvblByb3BzOiB7ICdhcmlhLWxhYmVsJzogJ0FkZCBvcmRlcmVkIGxpc3QnLCB0aXRsZTogJ0FkZCBvcmRlcmVkIGxpc3QnIH0sXG4gIGljb246IChcbiAgICA8c3ZnIGRhdGEtbmFtZT1cIm9yZGVyZWQtbGlzdFwiIHdpZHRoPVwiMTJcIiBoZWlnaHQ9XCIxMlwiIHJvbGU9XCJpbWdcIiB2aWV3Qm94PVwiMCAwIDUxMiA1MTJcIj5cbiAgICAgIDxwYXRoXG4gICAgICAgIGZpbGw9XCJjdXJyZW50Q29sb3JcIlxuICAgICAgICBkPVwiTTMuMjYzIDEzOS41MjdjMC03LjQ3NyAzLjkxNy0xMS41NzIgMTEuNTczLTExLjU3MmgxNS4xMzFWODguMDc4YzAtNS4xNjMuNTM0LTEwLjUwMy41MzQtMTAuNTAzaC0uMzU2cy0xLjc3OSAyLjY3LTIuODQ4IDMuNzM4Yy00LjQ1MSA0LjI3My0xMC41MDQgNC40NTEtMTUuNjY2LTEuMDY4bC01LjUxOC02LjIzMWMtNS4zNDItNS4zNDEtNC45ODQtMTEuMjE2LjUzNC0xNi4zNzlsMjEuNzItMTkuOTM4QzMyLjgxNSAzMy42MDIgMzYuNzMyIDMyIDQyLjc4NSAzMkg1NC44OWM3LjY1NiAwIDExLjc0OSAzLjkxNiAxMS43NDkgMTEuNTcydjg0LjM4NGgxNS40ODhjNy42NTUgMCAxMS41NzIgNC4wOTQgMTEuNTcyIDExLjU3MnY4LjkwMWMwIDcuNDc3LTMuOTE3IDExLjU3Mi0xMS41NzIgMTEuNTcySDE0LjgzNmMtNy42NTYgMC0xMS41NzMtNC4wOTUtMTEuNTczLTExLjU3MnYtOC45MDJ6TTIuMjExIDMwNC41OTFjMC00Ny4yNzggNTAuOTU1LTU2LjM4MyA1MC45NTUtNjkuMTY1IDAtNy4xOC01Ljk1NC04Ljc1NS05LjI4LTguNzU1LTMuMTUzIDAtNi40NzkgMS4wNTEtOS40NTUgMy44NTItNS4wNzkgNC45MDMtMTAuNTA3IDcuMDA0LTE2LjExMSAyLjQ1MWwtOC41NzktNi44MjljLTUuNzc5LTQuNTUzLTcuMTgtOS44MDUtMi44MDMtMTUuNDA5QzEzLjU5MiAyMDEuOTgxIDI2LjAyNSAxOTIgNDcuMzg3IDE5MmMxOS40MzcgMCA0NC40NzYgMTAuNTA2IDQ0LjQ3NiAzOS41NzMgMCAzOC4zNDctNDYuNzUzIDQ2LjQwMi00OC42NzkgNTYuOTA5aDM5LjA0OWM3LjUyOSAwIDExLjU1NyA0LjAyNyAxMS41NTcgMTEuMzgydjguNzU1YzAgNy4zNTQtNC4wMjggMTEuMzgyLTExLjU1NyAxMS4zODJoLTY3Ljk0Yy03LjAwNSAwLTEyLjA4My00LjAyOC0xMi4wODMtMTEuMzgydi00LjAyOHpNNS42NTQgNDU0LjYxbDUuNjAzLTkuMjhjMy44NTMtNi42NTQgOS4xMDUtNy4wMDQgMTUuNTg0LTMuMTUyIDQuOTAzIDIuMTAxIDkuNjMgMy4xNTIgMTQuMzU5IDMuMTUyIDEwLjE1NSAwIDE0LjM1OC0zLjUwMiAxNC4zNTgtOC4yMyAwLTYuNjU0LTUuNjA0LTkuMTA2LTE1LjkzNC05LjEwNmgtNC43MjhjLTUuOTU0IDAtOS4yOC0yLjEwMS0xMi4yNTgtNy44OGwtMS4wNS0xLjkyNmMtMi40NTEtNC43MjgtMS4yMjYtOS44MDYgMi44MDEtMTQuODg0bDUuNjA0LTcuMDA0YzYuODI5LTguNDA1IDEyLjI1Ny0xMy40ODMgMTIuMjU3LTEzLjQ4M3YtLjM1cy00LjIwMyAxLjA1MS0xMi42MDggMS4wNTFIMTYuNjg1Yy03LjUzIDAtMTEuMzgzLTQuMDI4LTExLjM4My0xMS4zODJ2LTguNzU1YzAtNy41MyAzLjg1My0xMS4zODIgMTEuMzgzLTExLjM4Mmg1OC40ODRjNy41MjkgMCAxMS4zODIgNC4wMjcgMTEuMzgyIDExLjM4MnYzLjMyN2MwIDUuNzc4LTEuNDAxIDkuODA2LTUuMDc5IDE0LjE4M2wtMTcuNTA5IDIwLjEzN2MxOS42MTEgNS4wNzggMjguNzE2IDIwLjQ4NyAyOC43MTYgMzQuODQ1IDAgMjEuMzYzLTE0LjM1OCA0NC4xMjYtNDguNTAzIDQ0LjEyNi0xNi42MzYgMC0yOC4xOTItNC43MjgtMzUuODk2LTkuNDU1LTUuNzc5LTQuMjAyLTYuMzA0LTkuODA1LTIuNjI2LTE1LjkzNHpNMTQ0IDEzMmgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNlY3NmMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2em0wIDE2MGgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNnYtNDBjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6XCJcbiAgICAgIC8+XG4gICAgPC9zdmc+XG4gICksXG4gIGV4ZWN1dGU6IChzdGF0ZTogVGV4dFN0YXRlLCBhcGk6IFRleHRBcmVhVGV4dEFwaSkgPT4ge1xuICAgIG1ha2VMaXN0KHN0YXRlLCBhcGksIChpdGVtLCBpbmRleCkgPT4gYCR7aW5kZXggKyAxfS4gYCk7XG4gIH0sXG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tlZExpc3RDb21tYW5kOiBJQ29tbWFuZCA9IHtcbiAgbmFtZTogJ2NoZWNrZWQtbGlzdCcsXG4gIGtleUNvbW1hbmQ6ICdsaXN0JyxcbiAgc2hvcnRjdXRzOiAnY3RybCtzaGlmdCtjJyxcbiAgYnV0dG9uUHJvcHM6IHsgJ2FyaWEtbGFiZWwnOiAnQWRkIGNoZWNrZWQgbGlzdCcsIHRpdGxlOiAnQWRkIGNoZWNrZWQgbGlzdCcgfSxcbiAgaWNvbjogKFxuICAgIDxzdmcgZGF0YS1uYW1lPVwiY2hlY2tlZC1saXN0XCIgd2lkdGg9XCIxMlwiIGhlaWdodD1cIjEyXCIgcm9sZT1cImltZ1wiIHZpZXdCb3g9XCIwIDAgNTEyIDUxMlwiPlxuICAgICAgPHBhdGhcbiAgICAgICAgZmlsbD1cImN1cnJlbnRDb2xvclwiXG4gICAgICAgIGQ9XCJNMjA4IDEzMmgyODhjOC44IDAgMTYtNy4yIDE2LTE2Vjc2YzAtOC44LTcuMi0xNi0xNi0xNkgyMDhjLTguOCAwLTE2IDcuMi0xNiAxNnY0MGMwIDguOCA3LjIgMTYgMTYgMTZ6bTAgMTYwaDI4OGM4LjggMCAxNi03LjIgMTYtMTZ2LTQwYzAtOC44LTcuMi0xNi0xNi0xNkgyMDhjLTguOCAwLTE2IDcuMi0xNiAxNnY0MGMwIDguOCA3LjIgMTYgMTYgMTZ6bTAgMTYwaDI4OGM4LjggMCAxNi03LjIgMTYtMTZ2LTQwYzAtOC44LTcuMi0xNi0xNi0xNkgyMDhjLTguOCAwLTE2IDcuMi0xNiAxNnY0MGMwIDguOCA3LjIgMTYgMTYgMTZ6TTY0IDM2OGMtMjYuNSAwLTQ4LjYgMjEuNS00OC42IDQ4czIyLjEgNDggNDguNiA0OCA0OC0yMS41IDQ4LTQ4LTIxLjUtNDgtNDgtNDh6bTkyLjUtMjk5bC03Mi4yIDcyLjItMTUuNiAxNS42Yy00LjcgNC43LTEyLjkgNC43LTE3LjYgMEwzLjUgMTA5LjRjLTQuNy00LjctNC43LTEyLjMgMC0xN2wxNS43LTE1LjdjNC43LTQuNyAxMi4zLTQuNyAxNyAwbDIyLjcgMjIuMSA2My43LTYzLjNjNC43LTQuNyAxMi4zLTQuNyAxNyAwbDE3IDE2LjVjNC42IDQuNyA0LjYgMTIuMy0uMSAxN3ptMCAxNTkuNmwtNzIuMiA3Mi4yLTE1LjcgMTUuN2MtNC43IDQuNy0xMi45IDQuNy0xNy42IDBMMy41IDI2OWMtNC43LTQuNy00LjctMTIuMyAwLTE3bDE1LjctMTUuN2M0LjctNC43IDEyLjMtNC43IDE3IDBsMjIuNyAyMi4xIDYzLjctNjMuN2M0LjctNC43IDEyLjMtNC43IDE3IDBsMTcgMTdjNC42IDQuNiA0LjYgMTIuMi0uMSAxNi45elwiXG4gICAgICAvPlxuICAgIDwvc3ZnPlxuICApLFxuICBleGVjdXRlOiAoc3RhdGU6IFRleHRTdGF0ZSwgYXBpOiBUZXh0QXJlYVRleHRBcGkpID0+IHtcbiAgICBtYWtlTGlzdChzdGF0ZSwgYXBpLCAoaXRlbSwgaW5kZXgpID0+IGAtIFsgXSBgKTtcbiAgfSxcbn07XG4iXX0=