"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = insertTextAtPosition;

/**
 * The MIT License
 * Copyright (c) 2018 Dmitriy Kubyshkin
 * Copied from https://github.com/grassator/insert-text-at-cursor
 */
var browserSupportsTextareaTextNodes;
/**
 * @param {HTMLElement} input
 * @return {boolean}
 */

function canManipulateViaTextNodes(input) {
  if (input.nodeName !== 'TEXTAREA') {
    return false;
  }

  if (typeof browserSupportsTextareaTextNodes === 'undefined') {
    var textarea = document.createElement('textarea');
    textarea.value = '1';
    browserSupportsTextareaTextNodes = !!textarea.firstChild;
  }

  return browserSupportsTextareaTextNodes;
}
/**
 * @param {HTMLTextAreaElement|HTMLInputElement} input
 * @param {string} text
 * @returns {void}
 */


function insertTextAtPosition(input, text) {
  // Most of the used APIs only work with the field selected
  input.focus(); // IE 8-10

  if (document.selection) {
    var ieRange = document.selection.createRange();
    ieRange.text = text; // Move cursor after the inserted text

    ieRange.collapse(false
    /* to the end */
    );
    ieRange.select();
    return;
  } // Webkit + Edge


  var isSuccess = document.execCommand('insertText', false, text);

  if (!isSuccess) {
    var start = input.selectionStart;
    var end = input.selectionEnd; // Firefox (non-standard method)

    if (typeof input.setRangeText === 'function') {
      input.setRangeText(text);
    } else {
      // To make a change we just need a Range, not a Selection
      var range = document.createRange();
      var textNode = document.createTextNode(text);

      if (canManipulateViaTextNodes(input)) {
        var node = input.firstChild; // If textarea is empty, just insert the text

        if (!node) {
          input.appendChild(textNode);
        } else {
          // Otherwise we need to find a nodes for start and end
          var offset = 0;
          var startNode = null;
          var endNode = null;

          while (node && (startNode === null || endNode === null)) {
            var nodeLength = node.nodeValue.length; // if start of the selection falls into current node

            if (start >= offset && start <= offset + nodeLength) {
              range.setStart(startNode = node, start - offset);
            } // if end of the selection falls into current node


            if (end >= offset && end <= offset + nodeLength) {
              range.setEnd(endNode = node, end - offset);
            }

            offset += nodeLength;
            node = node.nextSibling;
          } // If there is some text selected, remove it as we should replace it


          if (start !== end) {
            range.deleteContents();
          }
        }
      } // If the node is a textarea and the range doesn't span outside the element
      //
      // Get the commonAncestorContainer of the selected range and test its type
      // If the node is of type `#text` it means that we're still working with text nodes within our textarea element
      // otherwise, if it's of type `#document` for example it means our selection spans outside the textarea.


      if (canManipulateViaTextNodes(input) && range.commonAncestorContainer.nodeName === '#text') {
        // Finally insert a new node. The browser will automatically split start and end nodes into two if necessary
        range.insertNode(textNode);
      } else {
        // If the node is not a textarea or the range spans outside a textarea the only way is to replace the whole value
        var value = input.value;
        input.value = value.slice(0, start) + text + value.slice(end);
      }
    } // Correct the cursor position to be at the end of the insertion


    input.setSelectionRange(start + text.length, start + text.length); // Notify any possible listeners of the change

    var e = document.createEvent('UIEvent');
    e.initEvent('input', true, false);
    input.dispatchEvent(e);
  }
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9JbnNlcnRUZXh0QXRQb3NpdGlvbi50cyJdLCJuYW1lcyI6WyJicm93c2VyU3VwcG9ydHNUZXh0YXJlYVRleHROb2RlcyIsImNhbk1hbmlwdWxhdGVWaWFUZXh0Tm9kZXMiLCJpbnB1dCIsIm5vZGVOYW1lIiwidGV4dGFyZWEiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ2YWx1ZSIsImZpcnN0Q2hpbGQiLCJpbnNlcnRUZXh0QXRQb3NpdGlvbiIsInRleHQiLCJmb2N1cyIsInNlbGVjdGlvbiIsImllUmFuZ2UiLCJjcmVhdGVSYW5nZSIsImNvbGxhcHNlIiwic2VsZWN0IiwiaXNTdWNjZXNzIiwiZXhlY0NvbW1hbmQiLCJzdGFydCIsInNlbGVjdGlvblN0YXJ0IiwiZW5kIiwic2VsZWN0aW9uRW5kIiwic2V0UmFuZ2VUZXh0IiwicmFuZ2UiLCJ0ZXh0Tm9kZSIsImNyZWF0ZVRleHROb2RlIiwibm9kZSIsImFwcGVuZENoaWxkIiwib2Zmc2V0Iiwic3RhcnROb2RlIiwiZW5kTm9kZSIsIm5vZGVMZW5ndGgiLCJub2RlVmFsdWUiLCJsZW5ndGgiLCJzZXRTdGFydCIsInNldEVuZCIsIm5leHRTaWJsaW5nIiwiZGVsZXRlQ29udGVudHMiLCJjb21tb25BbmNlc3RvckNvbnRhaW5lciIsImluc2VydE5vZGUiLCJzbGljZSIsInNldFNlbGVjdGlvblJhbmdlIiwiZSIsImNyZWF0ZUV2ZW50IiwiaW5pdEV2ZW50IiwiZGlzcGF0Y2hFdmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFJQSxnQ0FBSjtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFNBQVNDLHlCQUFULENBQW1DQyxLQUFuQyxFQUFrRjtBQUNoRixNQUFJQSxLQUFLLENBQUNDLFFBQU4sS0FBbUIsVUFBdkIsRUFBbUM7QUFDakMsV0FBTyxLQUFQO0FBQ0Q7O0FBQ0QsTUFBSSxPQUFPSCxnQ0FBUCxLQUE0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LEtBQUssS0FBS0UsR0FBZCxFQUFtQjtBQUNqQkcsWUFBQUEsS0FBSyxDQUFDYyxjQUFOO0FBQ0Q7QUFDRjtBQUNGLE9BdkNJLENBeUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFVBQUlyQyx5QkFBeUIsQ0FBQ0MsS0FBRCxDQUF6QixJQUFvQ3NCLEtBQUssQ0FBQ2UsdUJBQU4sQ0FBOEJwQyxRQUE5QixLQUEyQyxPQUFuRixFQUE0RjtBQUMxRjtBQUNBcUIsUUFBQUEsS0FBSyxDQUFDZ0IsVUFBTixDQUFpQmYsUUFBakI7QUFDRCxPQUhELE1BR087QUFDTDtBQUNBLFlBQU1sQixLQUFLLEdBQUdMLEtBQUssQ0FBQ0ssS0FBcEI7QUFDQUwsUUFBQUEsS0FBSyxDQUFDSyxLQUFOLEdBQWNBLEtBQUssQ0FBQ2tDLEtBQU4sQ0FBWSxDQUFaLEVBQWV0QixLQUFmLElBQXdCVCxJQUF4QixHQUErQkgsS0FBSyxDQUFDa0MsS0FBTixDQUFZcEIsR0FBWixDQUE3QztBQUNEO0FBQ0YsS0E1RGEsQ0E4RGQ7OztBQUNBbkIsSUFBQUEsS0FBSyxDQUFDd0MsaUJBQU4sQ0FBd0J2QixLQUFLLEdBQUdULElBQUksQ0FBQ3dCLE1BQXJDLEVBQTZDZixLQUFLLEdBQUdULElBQUksQ0FBQ3dCLE1BQTFELEVBL0RjLENBaUVkOztBQUNBLFFBQU1TLENBQUMsR0FBR3RDLFFBQVEsQ0FBQ3VDLFdBQVQsQ0FBcUIsU0FBckIsQ0FBVjtBQUNBRCxJQUFBQSxDQUFDLENBQUNFLFNBQUYsQ0FBWSxPQUFaLEVBQXFCLElBQXJCLEVBQTJCLEtBQTNCO0FBQ0EzQyxJQUFBQSxLQUFLLENBQUM0QyxhQUFOLENBQW9CSCxDQUFwQjtBQUNEO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoZSBNSVQgTGljZW5zZVxuICogQ29weXJpZ2h0IChjKSAyMDE4IERtaXRyaXkgS3VieXNoa2luXG4gKiBDb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZ3Jhc3NhdG9yL2luc2VydC10ZXh0LWF0LWN1cnNvclxuICovXG5cbmxldCBicm93c2VyU3VwcG9ydHNUZXh0YXJlYVRleHROb2RlczogYW55O1xuXG4vKipcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGlucHV0XG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBjYW5NYW5pcHVsYXRlVmlhVGV4dE5vZGVzKGlucHV0OiBIVE1MVGV4dEFyZWFFbGVtZW50IHwgSFRNTElucHV0RWxlbWVudCkge1xuICBpZiAoaW5wdXQubm9kZU5hbWUgIT09ICdURVhUQVJFQScpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKHR5cGVvZiBicm93c2VyU3VwcG9ydHNUZXh0YXJlYVRleHROb2RlcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBjb25zdCB0ZXh0YXJlYTogSFRNTFRleHRBcmVhRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgdGV4dGFyZWEudmFsdWUgPSAnMSc7XG4gICAgYnJvd3NlclN1cHBvcnRzVGV4dGFyZWFUZXh0Tm9kZXMgPSAhIXRleHRhcmVhLmZpcnN0Q2hpbGQ7XG4gIH1cbiAgcmV0dXJuIGJyb3dzZXJTdXBwb3J0c1RleHRhcmVhVGV4dE5vZGVzO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7SFRNTFRleHRBcmVhRWxlbWVudHxIVE1MSW5wdXRFbGVtZW50fSBpbnB1dFxuICogQHBhcmFtIHtzdHJpbmd9IHRleHRcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpbnNlcnRUZXh0QXRQb3NpdGlvbihpbnB1dDogSFRNTFRleHRBcmVhRWxlbWVudCB8IEhUTUxJbnB1dEVsZW1lbnQsIHRleHQ6IHN0cmluZykge1xuICAvLyBNb3N0IG9mIHRoZSB1c2VkIEFQSXMgb25seSB3b3JrIHdpdGggdGhlIGZpZWxkIHNlbGVjdGVkXG4gIGlucHV0LmZvY3VzKCk7XG5cbiAgLy8gSUUgOC0xMFxuICBpZiAoKGRvY3VtZW50IGFzIGFueSkuc2VsZWN0aW9uKSB7XG4gICAgY29uc3QgaWVSYW5nZSA9IChkb2N1bWVudCBhcyBhbnkpLnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuICAgIGllUmFuZ2UudGV4dCA9IHRleHQ7XG5cbiAgICAvLyBNb3ZlIGN1cnNvciBhZnRlciB0aGUgaW5zZXJ0ZWQgdGV4dFxuICAgIGllUmFuZ2UuY29sbGFwc2UoZmFsc2UgLyogdG8gdGhlIGVuZCAqLyk7XG4gICAgaWVSYW5nZS5zZWxlY3QoKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFdlYmtpdCArIEVkZ2VcbiAgY29uc3QgaXNTdWNjZXNzID0gZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFRleHQnLCBmYWxzZSwgdGV4dCk7XG4gIGlmICghaXNTdWNjZXNzKSB7XG4gICAgY29uc3Qgc3RhcnQgPSBpbnB1dC5zZWxlY3Rpb25TdGFydCE7XG4gICAgY29uc3QgZW5kID0gaW5wdXQuc2VsZWN0aW9uRW5kITtcbiAgICAvLyBGaXJlZm94IChub24tc3RhbmRhcmQgbWV0aG9kKVxuICAgIGlmICh0eXBlb2YgaW5wdXQuc2V0UmFuZ2VUZXh0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpbnB1dC5zZXRSYW5nZVRleHQodGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRvIG1ha2UgYSBjaGFuZ2Ugd2UganVzdCBuZWVkIGEgUmFuZ2UsIG5vdCBhIFNlbGVjdGlvblxuICAgICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcblxuICAgICAgaWYgKGNhbk1hbmlwdWxhdGVWaWFUZXh0Tm9kZXMoaW5wdXQpKSB7XG4gICAgICAgIGxldCBub2RlID0gaW5wdXQuZmlyc3RDaGlsZDtcblxuICAgICAgICAvLyBJZiB0ZXh0YXJlYSBpcyBlbXB0eSwganVzdCBpbnNlcnQgdGhlIHRleHRcbiAgICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgICAgaW5wdXQuYXBwZW5kQ2hpbGQodGV4dE5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSBuZWVkIHRvIGZpbmQgYSBub2RlcyBmb3Igc3RhcnQgYW5kIGVuZFxuICAgICAgICAgIGxldCBvZmZzZXQgPSAwO1xuICAgICAgICAgIGxldCBzdGFydE5vZGUgPSBudWxsO1xuICAgICAgICAgIGxldCBlbmROb2RlID0gbnVsbDtcblxuICAgICAgICAgIHdoaWxlIChub2RlICYmIChzdGFydE5vZGUgPT09IG51bGwgfHwgZW5kTm9kZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVMZW5ndGggPSBub2RlLm5vZGVWYWx1ZSEubGVuZ3RoO1xuXG4gICAgICAgICAgICAvLyBpZiBzdGFydCBvZiB0aGUgc2VsZWN0aW9uIGZhbGxzIGludG8gY3VycmVudCBub2RlXG4gICAgICAgICAgICBpZiAoc3RhcnQgPj0gb2Zmc2V0ICYmIHN0YXJ0IDw9IG9mZnNldCArIG5vZGVMZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQoKHN0YXJ0Tm9kZSA9IG5vZGUpLCBzdGFydCAtIG9mZnNldCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIGVuZCBvZiB0aGUgc2VsZWN0aW9uIGZhbGxzIGludG8gY3VycmVudCBub2RlXG4gICAgICAgICAgICBpZiAoZW5kID49IG9mZnNldCAmJiBlbmQgPD0gb2Zmc2V0ICsgbm9kZUxlbmd0aCkge1xuICAgICAgICAgICAgICByYW5nZS5zZXRFbmQoKGVuZE5vZGUgPSBub2RlKSwgZW5kIC0gb2Zmc2V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb2Zmc2V0ICs9IG5vZGVMZW5ndGg7XG4gICAgICAgICAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBzb21lIHRleHQgc2VsZWN0ZWQsIHJlbW92ZSBpdCBhcyB3ZSBzaG91bGQgcmVwbGFjZSBpdFxuICAgICAgICAgIGlmIChzdGFydCAhPT0gZW5kKSB7XG4gICAgICAgICAgICByYW5nZS5kZWxldGVDb250ZW50cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBJZiB0aGUgbm9kZSBpcyBhIHRleHRhcmVhIGFuZCB0aGUgcmFuZ2UgZG9lc24ndCBzcGFuIG91dHNpZGUgdGhlIGVsZW1lbnRcbiAgICAgIC8vXG4gICAgICAvLyBHZXQgdGhlIGNvbW1vbkFuY2VzdG9yQ29udGFpbmVyIG9mIHRoZSBzZWxlY3RlZCByYW5nZSBhbmQgdGVzdCBpdHMgdHlwZVxuICAgICAgLy8gSWYgdGhlIG5vZGUgaXMgb2YgdHlwZSBgI3RleHRgIGl0IG1lYW5zIHRoYXQgd2UncmUgc3RpbGwgd29ya2luZyB3aXRoIHRleHQgbm9kZXMgd2l0aGluIG91ciB0ZXh0YXJlYSBlbGVtZW50XG4gICAgICAvLyBvdGhlcndpc2UsIGlmIGl0J3Mgb2YgdHlwZSBgI2RvY3VtZW50YCBmb3IgZXhhbXBsZSBpdCBtZWFucyBvdXIgc2VsZWN0aW9uIHNwYW5zIG91dHNpZGUgdGhlIHRleHRhcmVhLlxuICAgICAgaWYgKGNhbk1hbmlwdWxhdGVWaWFUZXh0Tm9kZXMoaW5wdXQpICYmIHJhbmdlLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyLm5vZGVOYW1lID09PSAnI3RleHQnKSB7XG4gICAgICAgIC8vIEZpbmFsbHkgaW5zZXJ0IGEgbmV3IG5vZGUuIFRoZSBicm93c2VyIHdpbGwgYXV0b21hdGljYWxseSBzcGxpdCBzdGFydCBhbmQgZW5kIG5vZGVzIGludG8gdHdvIGlmIG5lY2Vzc2FyeVxuICAgICAgICByYW5nZS5pbnNlcnROb2RlKHRleHROb2RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIHRoZSBub2RlIGlzIG5vdCBhIHRleHRhcmVhIG9yIHRoZSByYW5nZSBzcGFucyBvdXRzaWRlIGEgdGV4dGFyZWEgdGhlIG9ubHkgd2F5IGlzIHRvIHJlcGxhY2UgdGhlIHdob2xlIHZhbHVlXG4gICAgICAgIGNvbnN0IHZhbHVlID0gaW5wdXQudmFsdWU7XG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWUuc2xpY2UoMCwgc3RhcnQpICsgdGV4dCArIHZhbHVlLnNsaWNlKGVuZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29ycmVjdCB0aGUgY3Vyc29yIHBvc2l0aW9uIHRvIGJlIGF0IHRoZSBlbmQgb2YgdGhlIGluc2VydGlvblxuICAgIGlucHV0LnNldFNlbGVjdGlvblJhbmdlKHN0YXJ0ICsgdGV4dC5sZW5ndGgsIHN0YXJ0ICsgdGV4dC5sZW5ndGgpO1xuXG4gICAgLy8gTm90aWZ5IGFueSBwb3NzaWJsZSBsaXN0ZW5lcnMgb2YgdGhlIGNoYW5nZVxuICAgIGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnVUlFdmVudCcpO1xuICAgIGUuaW5pdEV2ZW50KCdpbnB1dCcsIHRydWUsIGZhbHNlKTtcbiAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KGUpO1xuICB9XG59XG4iXX0=