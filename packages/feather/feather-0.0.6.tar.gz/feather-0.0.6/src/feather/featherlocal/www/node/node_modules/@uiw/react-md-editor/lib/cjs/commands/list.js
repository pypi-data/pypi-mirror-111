"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.insertBeforeEachLine = insertBeforeEachLine;
exports.checkedListCommand = exports.orderedListCommand = exports.unorderedListCommand = exports.makeList = void 0;

var React = _interopRequireWildcard(require("react"));

var _markdownUtils = require("../utils/markdownUtils");

/**
 * Inserts insertionString before each line
 */
function insertBeforeEachLine(selectedText, insertBefore) {
  var lines = selectedText.split(/\n/);
  var insertionLength = 0;
  var modifiedText = lines.map(function (item, index) {
    if (typeof insertBefore === 'string') {
      insertionLength += insertBefore.length;
      return insertBefore + item;
    } else if (typeof insertBefore === 'function') {
      var insertionResult = insertBefore(item, index);
      insertionLength += insertionResult.length;
      return insertBefore(item, index) + item;
    }

    throw Error('insertion is expected to be either a string or a function');
  }).join('\n');
  return {
    modifiedText: modifiedText,
    insertionLength: insertionLength
  };
}

var makeList = function makeList(state, api, insertBefore) {
  // Adjust the selection to encompass the whole word if the caret is inside one
  var newSelectionRange = (0, _markdownUtils.selectWord)({
    text: state.text,
    selection: state.selection
  });
  var state1 = api.setSelectionRange(newSelectionRange);
  var breaksBeforeCount = (0, _markdownUtils.getBreaksNeededForEmptyLineBefore)(state1.text, state1.selection.start);
  var breaksBefore = Array(breaksBeforeCount + 1).join('\n');
  var breaksAfterCount = (0, _markdownUtils.getBreaksNeededForEmptyLineAfter)(state1.text, state1.selection.end);
  var breaksAfter = Array(breaksAfterCount + 1).join('\n');
  var modifiedText = insertBeforeEachLine(state1.selectedText, insertBefore);
  api.replaceSelection("".concat(breaksBefore).concat(modifiedText.modifiedText).concat(breaksAfter)); // Specifically when the text has only one line, we can exclude the "- ", for example, from the selection

  var oneLinerOffset = state1.selectedText.indexOf('\n') === -1 ? modifiedText.insertionLength : 0;
  var selectionStart = state1.selection.start + breaksBeforeCount + oneLinerOffset;
  var selectionEnd = selectionStart + modifiedText.modifiedText.length - oneLinerOffset; // Adjust the selection to not contain the **

  api.setSelectionRange({
    start: selectionStart,
    end: selectionEnd
  });
};

exports.makeList = makeList;
var unorderedListCommand = {
  name: 'unordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+l',
  buttonProps: {
    'aria-label': 'Add unordered list',
    title: 'Add unordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "unordered-list",
    width: "12",
    height: "12",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, '- ');
  }
};
exports.unorderedListCommand = unorderedListCommand;
var orderedListCommand = {
  name: 'ordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+o',
  buttonProps: {
    'aria-label': 'Add ordered list',
    title: 'Add ordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "ordered-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M3.263 139.527c0-7.477 3.917-11.572 11.573-11.572h15.131V88.078c0-5.163.534-10.503.534-10.503h-.356s-1.779 2.67-2.848 3.738c-4.451 4.273-10.504 4.451-15.666-1.068l-5.518-6.231c-5.342-5.341-4.984-11.216.534-16.379l21.72-19.938C32.815 33.602 36.732 32 42.785 32H54.89c7.656 0 11.749 3.916 11.749 11.572v84.384h15.488c7.655 0 11.572 4.094 11.572 11.572v8.901c0 7.477-3.917 11.572-11.572 11.572H14.836c-7.656 0-11.573-4.095-11.573-11.572v-8.902zM2.211 304.591c0-47.278 50.955-56.383 50.955-69.165 0-7.18-5.954-8.755-9.28-8.755-3.153 0-6.479 1.051-9.455 3.852-5.079 4.903-10.507 7.004-16.111 2.451l-8.579-6.829c-5.779-4.553-7.18-9.805-2.803-15.409C13.592 201.981 26.025 192 47.387 192c19.437 0 44.476 10.506 44.476 39.573 0 38.347-46.753 46.402-48.679 56.909h39.049c7.529 0 11.557 4.027 11.557 11.382v8.755c0 7.354-4.028 11.382-11.557 11.382h-67.94c-7.005 0-12.083-4.028-12.083-11.382v-4.028zM5.654 454.61l5.603-9.28c3.853-6.654 9.105-7.004 15.584-3.152 4.903 2.101 9.63 3.152 14.359 3.152 10.155 0 14.358-3.502 14.358-8.23 0-6.654-5.604-9.106-15.934-9.106h-4.728c-5.954 0-9.28-2.101-12.258-7.88l-1.05-1.926c-2.451-4.728-1.226-9.806 2.801-14.884l5.604-7.004c6.829-8.405 12.257-13.483 12.257-13.483v-.35s-4.203 1.051-12.608 1.051H16.685c-7.53 0-11.383-4.028-11.383-11.382v-8.755c0-7.53 3.853-11.382 11.383-11.382h58.484c7.529 0 11.382 4.027 11.382 11.382v3.327c0 5.778-1.401 9.806-5.079 14.183l-17.509 20.137c19.611 5.078 28.716 20.487 28.716 34.845 0 21.363-14.358 44.126-48.503 44.126-16.636 0-28.192-4.728-35.896-9.455-5.779-4.202-6.304-9.805-2.626-15.934zM144 132h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "".concat(index + 1, ". ");
    });
  }
};
exports.orderedListCommand = orderedListCommand;
var checkedListCommand = {
  name: 'checked-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+c',
  buttonProps: {
    'aria-label': 'Add checked list',
    title: 'Add checked list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "checked-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M208 132h288c8.8 0 16-7.2 16-16V76c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zM64 368c-26.5 0-48.6 21.5-48.6 48s22.1 48 48.6 48 48-21.5 48-48-21.5-48-48-48zm92.5-299l-72.2 72.2-15.6 15.6c-4.7 4.7-12.9 4.7-17.6 0L3.5 109.4c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.3c4.7-4.7 12.3-4.7 17 0l17 16.5c4.6 4.7 4.6 12.3-.1 17zm0 159.6l-72.2 72.2-15.7 15.7c-4.7 4.7-12.9 4.7-17.6 0L3.5 269c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.7c4.7-4.7 12.3-4.7 17 0l17 17c4.6 4.6 4.6 12.2-.1 16.9z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "- [ ] ";
    });
  }
};
exports.checkedListCommand = checkedListCommand;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tYW5kcy9saXN0LnRzeCJdLCJuYW1lcyI6WyJpbnNlcnRCZWZvcmVFYWNoTGluZSIsInNlbGVjdGVkVGV4dCIsImluc2VydEJlZm9yZSIsImxpbmVzIiwic3BsaXQiLCJpbnNlcnRpb25MZW5ndGgiLCJtb2RpZmllZFRleHQiLCJtYXAiLCJpdGVtIiwiaW5kZXgiLCJsZW5ndGgiLCJpbnNlcnRpb25SZXN1bHQiLCJFcnJvciIsImpvaW4iLCJtYWtlTGlzdCIsInN0YXRlIiwiYXBpIiwibmV3U2VsZWN0aW9uUmFuZ2UiLCJ0ZXh0Iiwic2VsZWN0aW9uIiwic3RhdGUxIiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJicmVha3NCZWZvcmVDb3VudCIsInN0YXJ0IiwiYnJlYWtzQmVmb3JlIiwiQXJyYXkiLCJicmVha3NBZnRlckNvdW50IiwiZW5kIiwiYnJlYWtzQWZ0ZXIiLCJyZXBsYWNlU2VsZWN0aW9uIiwib25lTGluZXJPZmZzZXQiLCJpbmRleE9mIiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJ1bm9yZGVyZWRMaXN0Q29tbWFuZCIsIm5hbWUiLCJrZXlDb21tYW5kIiwic2hvcnRjdXRzIiwiYnV0dG9uUHJvcHMiLCJ0aXRsZSIsImljb24iLCJleGVjdXRlIiwib3JkZXJlZExpc3RDb21tYW5kIiwiY2hlY2tlZExpc3RDb21tYW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBUUE7QUFDQTtBQUNBO0FBQ08sU0FBU0Esb0JBQVQsQ0FDTEMsWUFESyxFQUVMQyxZQUZLLEVBRzhDO0FBQ25ELE1BQU1DLEtBQUssR0FBR0YsWUFBWSxDQUFDRyxLQUFiLENBQW1CLElBQW5CLENBQWQ7QUFFQSxNQUFJQyxlQUFlLEdBQUcsQ0FBdEI7QUFDQSxNQUFNQyxZQUFZLEdBQUdILEtBQUssQ0FDdkJJLEdBRGtCLENBQ2QsVUFBQ0MsSUFBRCxFQUFPQyxLQUFQLEVBQWlCO0FBQ3BCLFFBQUksT0FBT1AsWUFB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QUFDRDtBQWZ5QyxDQUFyQzs7QUFrQkEsSUFBTWtDLGtCQUE0QixHQUFHO0FBQzFDUixFQUFBQSxJQUFJLEVBQUUsY0FEb0M7QUFFMUNDLEVBQUFBLFVBQVUsRUFBRSxNQUY4QjtBQUcxQ0MsRUFBQUEsU0FBUyxFQUFFLGNBSCtCO0FBSTFDQyxFQUFBQSxXQUFXLEVBQUU7QUFBRSxrQkFBYyxrQkFBaEI7QUFBb0NDLElBQUFBLEtBQUssRUFBRTtBQUEzQyxHQUo2QjtBQUsxQ0MsRUFBQUEsSUFBSSxlQUNGO0FBQUssaUJBQVUsY0FBZjtBQUE4QixJQUFBLEtBQUssRUFBQyxJQUFwQztBQUF5QyxJQUFBLE1BQU0sRUFBQyxJQUFoRDtBQUFxRCxJQUFBLElBQUksRUFBQyxLQUExRDtBQUFnRSxJQUFBLE9BQU8sRUFBQztBQUF4RSxrQkFDRTtBQUNFLElBQUEsSUFBSSxFQUFDLGNBRFA7QUFFRSxJQUFBLENBQUMsRUFBQztBQUZKLElBREYsQ0FOd0M7QUFhMUNDLEVBQUFBLE9BQU8sRUFBRSxpQkFBQzFCLEtBQUQsRUFBbUJDLEdBQW5CLEVBQTRDO0FBQ25ERixJQUFBQSxRQUFRLENBQUNDLEtBQUQsRUFBUUMsR0FBUixFQUFhLFVBQUNSLElBQUQsRUFBT0MsS0FBUDtBQUFBO0FBQUEsS0FBYixDQUFSO0FBQ0Q7QUFmeUMsQ0FBckMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJQ29tbWFuZCwgVGV4dFN0YXRlLCBUZXh0QXJlYVRleHRBcGkgfSBmcm9tICcuLyc7XG5pbXBvcnQge1xuICBzZWxlY3RXb3JkLFxuICBnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVCZWZvcmUsXG4gIGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUFmdGVyLFxufSBmcm9tICcuLi91dGlscy9tYXJrZG93blV0aWxzJztcblxuZXhwb3J0IHR5cGUgQWx0ZXJMaW5lRnVuY3Rpb24gPSAobGluZTogc3RyaW5nLCBpbmRleDogbnVtYmVyKSA9PiBzdHJpbmc7XG5cbi8qKlxuICogSW5zZXJ0cyBpbnNlcnRpb25TdHJpbmcgYmVmb3JlIGVhY2ggbGluZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QmVmb3JlRWFjaExpbmUoXG4gIHNlbGVjdGVkVGV4dDogc3RyaW5nLFxuICBpbnNlcnRCZWZvcmU6IHN0cmluZyB8IEFsdGVyTGluZUZ1bmN0aW9uLFxuKTogeyBtb2RpZmllZFRleHQ6IHN0cmluZzsgaW5zZXJ0aW9uTGVuZ3RoOiBudW1iZXIgfSB7XG4gIGNvbnN0IGxpbmVzID0gc2VsZWN0ZWRUZXh0LnNwbGl0KC9cXG4vKTtcblxuICBsZXQgaW5zZXJ0aW9uTGVuZ3RoID0gMDtcbiAgY29uc3QgbW9kaWZpZWRUZXh0ID0gbGluZXNcbiAgICAubWFwKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBpbnNlcnRCZWZvcmUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGluc2VydGlvbkxlbmd0aCArPSBpbnNlcnRCZWZvcmUubGVuZ3RoO1xuICAgICAgICByZXR1cm4gaW5zZXJ0QmVmb3JlICsgaXRlbTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGluc2VydEJlZm9yZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjb25zdCBpbnNlcnRpb25SZXN1bHQgPSBpbnNlcnRCZWZvcmUoaXRlbSwgaW5kZXgpO1xuICAgICAgICBpbnNlcnRpb25MZW5ndGggKz0gaW5zZXJ0aW9uUmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGluc2VydEJlZm9yZShpdGVtLCBpbmRleCkgKyBpdGVtO1xuICAgICAgfVxuICAgICAgdGhyb3cgRXJyb3IoJ2luc2VydGlvbiBpcyBleHBlY3RlZCB0byBiZSBlaXRoZXIgYSBzdHJpbmcgb3IgYSBmdW5jdGlvbicpO1xuICAgIH0pXG4gICAgLmpvaW4oJ1xcbicpO1xuXG4gIHJldHVybiB7IG1vZGlmaWVkVGV4dCwgaW5zZXJ0aW9uTGVuZ3RoIH07XG59XG5cbmV4cG9ydCBjb25zdCBtYWtlTGlzdCA9IChzdGF0ZTogVGV4dFN0YXRlLCBhcGk6IFRleHRBcmVhVGV4dEFwaSwgaW5zZXJ0QmVmb3JlOiBzdHJpbmcgfCBBbHRlckxpbmVGdW5jdGlvbikgPT4ge1xuICAvLyBBZGp1c3QgdGhlIHNlbGVjdGlvbiB0byBlbmNvbXBhc3MgdGhlIHdob2xlIHdvcmQgaWYgdGhlIGNhcmV0IGlzIGluc2lkZSBvbmVcbiAgY29uc3QgbmV3U2VsZWN0aW9uUmFuZ2UgPSBzZWxlY3RXb3JkKHsgdGV4dDogc3RhdGUudGV4dCwgc2VsZWN0aW9uOiBzdGF0ZS5zZWxlY3Rpb24gfSk7XG4gIGNvbnN0IHN0YXRlMSA9IGFwaS5zZXRTZWxlY3Rpb25SYW5nZShuZXdTZWxlY3Rpb25SYW5nZSk7XG5cbiAgY29uc3QgYnJlYWtzQmVmb3JlQ291bnQgPSBnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVCZWZvcmUoc3RhdGUxLnRleHQsIHN0YXRlMS5zZWxlY3Rpb24uc3RhcnQpO1xuICBjb25zdCBicmVha3NCZWZvcmUgPSBBcnJheShicmVha3NCZWZvcmVDb3VudCArIDEpLmpvaW4oJ1xcbicpO1xuXG4gIGNvbnN0IGJyZWFrc0FmdGVyQ291bnQgPSBnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVBZnRlcihzdGF0ZTEudGV4dCwgc3RhdGUxLnNlbGVjdGlvbi5lbmQpO1xuICBjb25zdCBicmVha3NBZnRlciA9IEFycmF5KGJyZWFrc0FmdGVyQ291bnQgKyAxKS5qb2luKCdcXG4nKTtcblxuICBjb25zdCBtb2RpZmllZFRleHQgPSBpbnNlcnRCZWZvcmVFYWNoTGluZShzdGF0ZTEuc2VsZWN0ZWRUZXh0LCBpbnNlcnRCZWZvcmUpO1xuXG4gIGFwaS5yZXBsYWNlU2VsZWN0aW9uKGAke2JyZWFrc0JlZm9yZX0ke21vZGlmaWVkVGV4dC5tb2RpZmllZFRleHR9JHticmVha3NBZnRlcn1gKTtcblxuICAvLyBTcGVjaWZpY2FsbHkgd2hlbiB0aGUgdGV4dCBoYXMgb25seSBvbmUgbGluZSwgd2UgY2FuIGV4Y2x1ZGUgdGhlIFwiLSBcIiwgZm9yIGV4YW1wbGUsIGZyb20gdGhlIHNlbGVjdGlvblxuICBjb25zdCBvbmVMaW5lck9mZnNldCA9IHN0YXRlMS5zZWxlY3RlZFRleHQuaW5kZXhPZignXFxuJykgPT09IC0xID8gbW9kaWZpZWRUZXh0Lmluc2VydGlvbkxlbmd0aCA6IDA7XG5cbiAgY29uc3Qgc2VsZWN0aW9uU3RhcnQgPSBzdGF0ZTEuc2VsZWN0aW9uLnN0YXJ0ICsgYnJlYWtzQmVmb3JlQ291bnQgKyBvbmVMaW5lck9mZnNldDtcbiAgY29uc3Qgc2VsZWN0aW9uRW5kID0gc2VsZWN0aW9uU3RhcnQgKyBtb2RpZmllZFRleHQubW9kaWZpZWRUZXh0Lmxlbmd0aCAtIG9uZUxpbmVyT2Zmc2V0O1xuXG4gIC8vIEFkanVzdCB0aGUgc2VsZWN0aW9uIHRvIG5vdCBjb250YWluIHRoZSAqKlxuICBhcGkuc2V0U2VsZWN0aW9uUmFuZ2Uoe1xuICAgIHN0YXJ0OiBzZWxlY3Rpb25TdGFydCxcbiAgICBlbmQ6IHNlbGVjdGlvbkVuZCxcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgdW5vcmRlcmVkTGlzdENvbW1hbmQ6IElDb21tYW5kID0ge1xuICBuYW1lOiAndW5vcmRlcmVkLWxpc3QnLFxuICBrZXlDb21tYW5kOiAnbGlzdCcsXG4gIHNob3J0Y3V0czogJ2N0cmwrc2hpZnQrbCcsXG4gIGJ1dHRvblByb3BzOiB7ICdhcmlhLWxhYmVsJzogJ0FkZCB1bm9yZGVyZWQgbGlzdCcsIHRpdGxlOiAnQWRkIHVub3JkZXJlZCBsaXN0JyB9LFxuICBpY29uOiAoXG4gICAgPHN2ZyBkYXRhLW5hbWU9XCJ1bm9yZGVyZWQtbGlzdFwiIHdpZHRoPVwiMTJcIiBoZWlnaHQ9XCIxMlwiIHZpZXdCb3g9XCIwIDAgNTEyIDUxMlwiPlxuICAgICAgPHBhdGhcbiAgICAgICAgZmlsbD1cImN1cnJlbnRDb2xvclwiXG4gICAgICAgIGQ9XCJNOTYgOTZjMCAyNi41MS0yMS40OSA0OC00OCA0OFMwIDEyMi41MSAwIDk2czIxLjQ5LTQ4IDQ4LTQ4IDQ4IDIxLjQ5IDQ4IDQ4ek00OCAyMDhjLTI2LjUxIDAtNDggMjEuNDktNDggNDhzMjEuNDkgNDggNDggNDggNDgtMjEuNDkgNDgtNDgtMjEuNDktNDgtNDgtNDh6bTAgMTYwYy0yNi41MSAwLTQ4IDIxLjQ5LTQ4IDQ4czIxLjQ5IDQ4IDQ4IDQ4IDQ4LTIxLjQ5IDQ4LTQ4LTIxLjQ5LTQ4LTQ4LTQ4em05Ni0yMzZoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZWNzZjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6bTAgMTYwaDM1MmM4LjgzNyAwIDE2LTcuMTYzIDE2LTE2di00MGMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2elwiXG4gICAgICAvPlxuICAgIDwvc3ZnPlxuICApLFxuICBleGVjdXRlOiAoc3RhdGU6IFRleHRTdGF0ZSwgYXBpOiBUZXh0QXJlYVRleHRBcGkpID0+IHtcbiAgICBtYWtlTGlzdChzdGF0ZSwgYXBpLCAnLSAnKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCBvcmRlcmVkTGlzdENvbW1hbmQ6IElDb21tYW5kID0ge1xuICBuYW1lOiAnb3JkZXJlZC1saXN0JyxcbiAga2V5Q29tbWFuZDogJ2xpc3QnLFxuICBzaG9ydGN1dHM6ICdjdHJsK3NoaWZ0K28nLFxuICBidXR0b25Qcm9wczogeyAnYXJpYS1sYWJlbCc6ICdBZGQgb3JkZXJlZCBsaXN0JywgdGl0bGU6ICdBZGQgb3JkZXJlZCBsaXN0JyB9LFxuICBpY29uOiAoXG4gICAgPHN2ZyBkYXRhLW5hbWU9XCJvcmRlcmVkLWxpc3RcIiB3aWR0aD1cIjEyXCIgaGVpZ2h0PVwiMTJcIiByb2xlPVwiaW1nXCIgdmlld0JveD1cIjAgMCA1MTIgNTEyXCI+XG4gICAgICA8cGF0aFxuICAgICAgICBmaWxsPVwiY3VycmVudENvbG9yXCJcbiAgICAgICAgZD1cIk0zLjI2MyAxMzkuNTI3YzAtNy40NzcgMy45MTctMTEuNTcyIDExLjU3My0xMS41NzJoMTUuMTMxVjg4LjA3OGMwLTUuMTYzLjUzNC0xMC41MDMuNTM0LTEwLjUwM2gtLjM1NnMtMS43NzkgMi42Ny0yLjg0OCAzLjczOGMtNC40NTEgNC4yNzMtMTAuNTA0IDQuNDUxLTE1LjY2Ni0xLjA2OGwtNS41MTgtNi4yMzFjLTUuMzQyLTUuMzQxLTQuOTg0LTExLjIxNi41MzQtMTYuMzc5bDIxLjcyLTE5LjkzOEMzMi44MTUgMzMuNjAyIDM2LjczMiAzMiA0Mi43ODUgMzJINTQuODljNy42NTYgMCAxMS43NDkgMy45MTYgMTEuNzQ5IDExLjU3MnY4NC4zODRoMTUuNDg4YzcuNjU1IDAgMTEuNTcyIDQuMDk0IDExLjU3MiAxMS41NzJ2OC45MDFjMCA3LjQ3Ny0zLjkxNyAxMS41NzItMTEuNTcyIDExLjU3MkgxNC44MzZjLTcuNjU2IDAtMTEuNTczLTQuMDk1LTExLjU3My0xMS41NzJ2LTguOTAyek0yLjIxMSAzMDQuNTkxYzAtNDcuMjc4IDUwLjk1NS01Ni4zODMgNTAuOTU1LTY5LjE2NSAwLTcuMTgtNS45NTQtOC43NTUtOS4yOC04Ljc1NS0zLjE1MyAwLTYuNDc5IDEuMDUxLTkuNDU1IDMuODUyLTUuMDc5IDQuOTAzLTEwLjUwNyA3LjAwNC0xNi4xMTEgMi40NTFsLTguNTc5LTYuODI5Yy01Ljc3OS00LjU1My03LjE4LTkuODA1LTIuODAzLTE1LjQwOUMxMy41OTIgMjAxLjk4MSAyNi4wMjUgMTkyIDQ3LjM4NyAxOTJjMTkuNDM3IDAgNDQuNDc2IDEwLjUwNiA0NC40NzYgMzkuNTczIDAgMzguMzQ3LTQ2Ljc1MyA0Ni40MDItNDguNjc5IDU2LjkwOWgzOS4wNDljNy41MjkgMCAxMS41NTcgNC4wMjcgMTEuNTU3IDExLjM4MnY4Ljc1NWMwIDcuMzU0LTQuMDI4IDExLjM4Mi0xMS41NTcgMTEuMzgyaC02Ny45NGMtNy4wMDUgMC0xMi4wODMtNC4wMjgtMTIuMDgzLTExLjM4MnYtNC4wMjh6TTUuNjU0IDQ1NC42MWw1LjYwMy05LjI4YzMuODUzLTYuNjU0IDkuMTA1LTcuMDA0IDE1LjU4NC0zLjE1MiA0LjkwMyAyLjEwMSA5LjYzIDMuMTUyIDE0LjM1OSAzLjE1MiAxMC4xNTUgMCAxNC4zNTgtMy41MDIgMTQuMzU4LTguMjMgMC02LjY1NC01LjYwNC05LjEwNi0xNS45MzQtOS4xMDZoLTQuNzI4Yy01Ljk1NCAwLTkuMjgtMi4xMDEtMTIuMjU4LTcuODhsLTEuMDUtMS45MjZjLTIuNDUxLTQuNzI4LTEuMjI2LTkuODA2IDIuODAxLTE0Ljg4NGw1LjYwNC03LjAwNGM2LjgyOS04LjQwNSAxMi4yNTctMTMuNDgzIDEyLjI1Ny0xMy40ODN2LS4zNXMtNC4yMDMgMS4wNTEtMTIuNjA4IDEuMDUxSDE2LjY4NWMtNy41MyAwLTExLjM4My00LjAyOC0xMS4zODMtMTEuMzgydi04Ljc1NWMwLTcuNTMgMy44NTMtMTEuMzgyIDExLjM4My0xMS4zODJoNTguNDg0YzcuNTI5IDAgMTEuMzgyIDQuMDI3IDExLjM4MiAxMS4zODJ2My4zMjdjMCA1Ljc3OC0xLjQwMSA5LjgwNi01LjA3OSAxNC4xODNsLTE3LjUwOSAyMC4xMzdjMTkuNjExIDUuMDc4IDI4LjcxNiAyMC40ODcgMjguNzE2IDM0Ljg0NSAwIDIxLjM2My0xNC4zNTggNDQuMTI2LTQ4LjUwMyA0NC4xMjYtMTYuNjM2IDAtMjguMTkyLTQuNzI4LTM1Ljg5Ni05LjQ1NS01Ljc3OS00LjIwMi02LjMwNC05LjgwNS0yLjYyNi0xNS45MzR6TTE0NCAxMzJoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZWNzZjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6bTAgMTYwaDM1MmM4LjgzNyAwIDE2LTcuMTYzIDE2LTE2di00MGMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2elwiXG4gICAgICAvPlxuICAgIDwvc3ZnPlxuICApLFxuICBleGVjdXRlOiAoc3RhdGU6IFRleHRTdGF0ZSwgYXBpOiBUZXh0QXJlYVRleHRBcGkpID0+IHtcbiAgICBtYWtlTGlzdChzdGF0ZSwgYXBpLCAoaXRlbSwgaW5kZXgpID0+IGAke2luZGV4ICsgMX0uIGApO1xuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IGNoZWNrZWRMaXN0Q29tbWFuZDogSUNvbW1hbmQgPSB7XG4gIG5hbWU6ICdjaGVja2VkLWxpc3QnLFxuICBrZXlDb21tYW5kOiAnbGlzdCcsXG4gIHNob3J0Y3V0czogJ2N0cmwrc2hpZnQrYycsXG4gIGJ1dHRvblByb3BzOiB7ICdhcmlhLWxhYmVsJzogJ0FkZCBjaGVja2VkIGxpc3QnLCB0aXRsZTogJ0FkZCBjaGVja2VkIGxpc3QnIH0sXG4gIGljb246IChcbiAgICA8c3ZnIGRhdGEtbmFtZT1cImNoZWNrZWQtbGlzdFwiIHdpZHRoPVwiMTJcIiBoZWlnaHQ9XCIxMlwiIHJvbGU9XCJpbWdcIiB2aWV3Qm94PVwiMCAwIDUxMiA1MTJcIj5cbiAgICAgIDxwYXRoXG4gICAgICAgIGZpbGw9XCJjdXJyZW50Q29sb3JcIlxuICAgICAgICBkPVwiTTIwOCAxMzJoMjg4YzguOCAwIDE2LTcuMiAxNi0xNlY3NmMwLTguOC03LjItMTYtMTYtMTZIMjA4Yy04LjggMC0xNiA3LjItMTYgMTZ2NDBjMCA4LjggNy4yIDE2IDE2IDE2em0wIDE2MGgyODhjOC44IDAgMTYtNy4yIDE2LTE2di00MGMwLTguOC03LjItMTYtMTYtMTZIMjA4Yy04LjggMC0xNiA3LjItMTYgMTZ2NDBjMCA4LjggNy4yIDE2IDE2IDE2em0wIDE2MGgyODhjOC44IDAgMTYtNy4yIDE2LTE2di00MGMwLTguOC03LjItMTYtMTYtMTZIMjA4Yy04LjggMC0xNiA3LjItMTYgMTZ2NDBjMCA4LjggNy4yIDE2IDE2IDE2ek02NCAzNjhjLTI2LjUgMC00OC42IDIxLjUtNDguNiA0OHMyMi4xIDQ4IDQ4LjYgNDggNDgtMjEuNSA0OC00OC0yMS41LTQ4LTQ4LTQ4em05Mi41LTI5OWwtNzIuMiA3Mi4yLTE1LjYgMTUuNmMtNC43IDQuNy0xMi45IDQuNy0xNy42IDBMMy41IDEwOS40Yy00LjctNC43LTQuNy0xMi4zIDAtMTdsMTUuNy0xNS43YzQuNy00LjcgMTIuMy00LjcgMTcgMGwyMi43IDIyLjEgNjMuNy02My4zYzQuNy00LjcgMTIuMy00LjcgMTcgMGwxNyAxNi41YzQuNiA0LjcgNC42IDEyLjMtLjEgMTd6bTAgMTU5LjZsLTcyLjIgNzIuMi0xNS43IDE1LjdjLTQuNyA0LjctMTIuOSA0LjctMTcuNiAwTDMuNSAyNjljLTQuNy00LjctNC43LTEyLjMgMC0xN2wxNS43LTE1LjdjNC43LTQuNyAxMi4zLTQuNyAxNyAwbDIyLjcgMjIuMSA2My43LTYzLjdjNC43LTQuNyAxMi4zLTQuNyAxNyAwbDE3IDE3YzQuNiA0LjYgNC42IDEyLjItLjEgMTYuOXpcIlxuICAgICAgLz5cbiAgICA8L3N2Zz5cbiAgKSxcbiAgZXhlY3V0ZTogKHN0YXRlOiBUZXh0U3RhdGUsIGFwaTogVGV4dEFyZWFUZXh0QXBpKSA9PiB7XG4gICAgbWFrZUxpc3Qoc3RhdGUsIGFwaSwgKGl0ZW0sIGluZGV4KSA9PiBgLSBbIF0gYCk7XG4gIH0sXG59O1xuIl19