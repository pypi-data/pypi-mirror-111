"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = TextArea;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _Context = require("../../Context");

var _shortcuts = _interopRequireDefault(require("./shortcuts"));

var _Markdown = _interopRequireDefault(require("./Markdown"));

var _Textarea = _interopRequireDefault(require("./Textarea"));

var _commands = require("../../commands");

var _excluded = ["prefixCls", "className", "onScroll", "renderTextarea"];

function TextArea(props) {
  var _ref = props || {},
      prefixCls = _ref.prefixCls,
      className = _ref.className,
      onScroll = _ref.onScroll,
      renderTextarea = _ref.renderTextarea,
      otherProps = (0, _objectWithoutProperties2.default)(_ref, _excluded);

  var _useContext = (0, _react.useContext)(_Context.EditorContext),
      markdown = _useContext.markdown,
      scrollTop = _useContext.scrollTop,
      commands = _useContext.commands,
      extraCommands = _useContext.extraCommands,
      onChange = _useContext.onChange,
      dispatch = _useContext.dispatch;

  var textRef = _react.default.useRef(null);

  var executeRef = _react.default.useRef();

  var warp = /*#__PURE__*/_react.default.createRef();

  (0, _react.useEffect)(function () {
    var state = {};

    if (warp.current) {
      state.textareaWarp = warp.current || undefined;
      warp.current.scrollTop = scrollTop || 0;
    }

    if (dispatch) {
      dispatch((0, _objectSpread2.default)({}, state));
    } // eslint-disable-next-line react-hooks/exhaustive-deps

  }, []);
  (0, _react.useEffect)(function () {
    if (textRef.current && dispatch) {
      var _commandOrchestrator = new _commands.TextAreaCommandOrchestrator(textRef.current);

      executeRef.current = _commandOrchestrator;
      dispatch({
        textarea: textRef.current,
        commandOrchestrator: _commandOrchestrator
      });
    } // eslint-disable-next-line react-hooks/exhaustive-deps

  }, []);
  return /*#__PURE__*/_react.default.createElement("div", {
    ref: warp,
    className: "".concat(prefixCls, "-aree ").concat(className || ''),
    onScroll: onScroll
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "".concat(prefixCls, "-text")
  }, renderTextarea ? /*#__PURE__*/_react.default.cloneElement(renderTextarea((0, _objectSpread2.default)((0, _objectSpread2.default)({}, otherProps), {}, {
    value: markdown,
    autoComplete: 'off',
    autoCorrect: 'off',
    spellCheck: 'false',
    autoCapitalize: 'off',
    className: "".concat(prefixCls, "-text-input"),
    style: {
      WebkitTextFillColor: 'inherit',
      overflow: 'auto'
    }
  }), {
    dispatch: dispatch,
    onChange: onChange,
    shortcuts: _shortcuts.default,
    useContext: {
      commands: commands,
      extraCommands: extraCommands,
      commandOrchestrator: executeRef.current
    }
  }), {
    ref: textRef
  }) : /*#__PURE__*/_react.default.createElement(_react.Fragment, null, /*#__PURE__*/_react.default.createElement(_Markdown.default, {
    prefixCls: prefixCls
  }), /*#__PURE__*/_react.default.createElement(_Textarea.default, (0, _extends2.default)({
    prefixCls: prefixCls
  }, otherProps)))));
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1RleHRBcmVhL2luZGV4LnRzeCJdLCJuYW1lcyI6WyJUZXh0QXJlYSIsInByb3BzIiwicHJlZml4Q2xzIiwiY2xhc3NOYW1lIiwib25TY3JvbGwiLCJyZW5kZXJUZXh0YXJlYSIsIm90aGVyUHJvcHMiLCJFZGl0b3JDb250ZXh0IiwibWFya2Rvd24iLCJzY3JvbGxUb3AiLCJjb21tYW5kcyIsImV4dHJhQ29tbWFuZHMiLCJvbkNoYW5nZSIsImRpc3BhdGNoIiwidGV4dFJlZiIsIlJlYWN0IiwidXNlUmVmIiwiZXhlY3V0ZVJlZiIsIndhcnAiLCJjcmVhdGVSZWYiLCJzdGF0ZSIsImN1cnJlbnQiLCJ0ZXh0YXJlYVdhcnAiLCJ1bmRlZmluZWQiLCJjb21tYW5kT3JjaGVzdHJhdG9yIiwiVGV4dEFyZWFDb21tYW5kT3JjaGVzdHJhdG9yIiwidGV4dGFyZWEiLCJjbG9uZUVsZW1lbnQiLCJ2YWx1ZSIsImF1dG9Db21wbGV0ZSIsImF1dG9Db3JyZWN0Iiwic3BlbGxDaGVjayIsImF1dG9DYXBpdGFsaXplIiwic3R5bGUiLCJXZWJraXRUZXh0RmlsbENvbG9yIiwib3ZlcmZsb3ciLCJzaG9ydGN1dHMiLCJ1c2VDb250ZXh0IiwicmVmIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOzs7O0FBb0NlLFNBQVNBLFFBQVQsQ0FBa0JDLEtBQWxCLEVBQXlDO0FBQ3RELGFBQTBFQSxLQUFLLElBQUksRUFBbkY7QUFBQSxNQUFRQyxTQUFSLFFBQVFBLFNBQVI7QUFBQSxNQUFtQkMsU0FBbkIsUUFBbUJBLFNBQW5CO0FBQUEsTUFBOEJDLFFBQTlCLFFBQThCQSxRQUE5QjtBQUFBLE1BQXdDQyxjQUF4QyxRQUF3Q0EsY0FBeEM7QUFBQSxNQUEyREMsVUFBM0Q7O0FBQ0Esb0JBQTZFLHVCQUFXQyxzQkFBWCxDQUE3RTtBQUFBLE1BQVFDLFFBQVIsZUFBUUEs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RjtBQXVDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIEZyYWdtZW50LCB1c2VDb250ZXh0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRWRpdG9yQ29udGV4dCwgQ29udGV4dFN0b3JlLCBFeGVjdXRlQ29tbWFuZFN0YXRlIH0gZnJvbSAnLi4vLi4vQ29udGV4dCc7XG5pbXBvcnQgc2hvcnRjdXRzIGZyb20gJy4vc2hvcnRjdXRzJztcbmltcG9ydCBNYXJrZG93biBmcm9tICcuL01hcmtkb3duJztcbmltcG9ydCBUZXh0YXJlYSBmcm9tICcuL1RleHRhcmVhJztcbmltcG9ydCB7IElQcm9wcyB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IE1ERWRpdG9yUHJvcHMgfSBmcm9tICcuLi8uLi9FZGl0b3InO1xuaW1wb3J0IHsgVGV4dEFyZWFDb21tYW5kT3JjaGVzdHJhdG9yLCBJQ29tbWFuZCB9IGZyb20gJy4uLy4uL2NvbW1hbmRzJztcbmltcG9ydCAnLi9pbmRleC5sZXNzJztcblxudHlwZSBSZW5kZXJUZXh0YXJlYUhhbmRsZSA9IHtcbiAgZGlzcGF0Y2g6IENvbnRleHRTdG9yZVsnZGlzcGF0Y2gnXTtcbiAgb25DaGFuZ2U/OiBNREVkaXRvclByb3BzWydvbkNoYW5nZSddO1xuICB1c2VDb250ZXh0Pzoge1xuICAgIGNvbW1hbmRzOiBDb250ZXh0U3RvcmVbJ2NvbW1hbmRzJ107XG4gICAgZXh0cmFDb21tYW5kczogQ29udGV4dFN0b3JlWydleHRyYUNvbW1hbmRzJ107XG4gICAgY29tbWFuZE9yY2hlc3RyYXRvcj86IFRleHRBcmVhQ29tbWFuZE9yY2hlc3RyYXRvcjtcbiAgfTtcbiAgc2hvcnRjdXRzPzogKFxuICAgIGU6IEtleWJvYXJkRXZlbnQgfCBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxUZXh0QXJlYUVsZW1lbnQ+LFxuICAgIGNvbW1hbmRzOiBJQ29tbWFuZFtdLFxuICAgIGNvbW1hbmRPcmNoZXN0cmF0b3I/OiBUZXh0QXJlYUNvbW1hbmRPcmNoZXN0cmF0b3IsXG4gICAgZGlzcGF0Y2g/OiBSZWFjdC5EaXNwYXRjaDxDb250ZXh0U3RvcmU+LFxuICAgIHN0YXRlPzogRXhlY3V0ZUNvbW1hbmRTdGF0ZSxcbiAgKSA9PiB2b2lkO1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBJVGV4dEFyZWFQcm9wc1xuICBleHRlbmRzIE9taXQ8UmVhY3QuVGV4dGFyZWFIVE1MQXR0cmlidXRlczxIVE1MVGV4dEFyZWFFbGVtZW50PiwgJ3ZhbHVlJyB8ICdvbkNoYW5nZScgfCAnb25TY3JvbGwnPixcbiAgICBJUHJvcHMge1xuICB2YWx1ZT86IHN0cmluZztcbiAgb25TY3JvbGw/OiAoZTogUmVhY3QuVUlFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHZvaWQ7XG4gIHJlbmRlclRleHRhcmVhPzogKFxuICAgIHByb3BzOiBSZWFjdC5UZXh0YXJlYUhUTUxBdHRyaWJ1dGVzPEhUTUxUZXh0QXJlYUVsZW1lbnQ+IHwgUmVhY3QuSFRNTEF0dHJpYnV0ZXM8SFRNTERpdkVsZW1lbnQ+LFxuICAgIG9wdHM6IFJlbmRlclRleHRhcmVhSGFuZGxlLFxuICApID0+IEpTWC5FbGVtZW50O1xufVxuXG5leHBvcnQgdHlwZSBUZXh0QXJlYVJlZiA9IHtcbiAgdGV4dD86IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIHdhcnA/OiBIVE1MRGl2RWxlbWVudDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFRleHRBcmVhKHByb3BzOiBJVGV4dEFyZWFQcm9wcykge1xuICBjb25zdCB7IHByZWZpeENscywgY2xhc3NOYW1lLCBvblNjcm9sbCwgcmVuZGVyVGV4dGFyZWEsIC4uLm90aGVyUHJvcHMgfSA9IHByb3BzIHx8IHt9O1xuICBjb25zdCB7IG1hcmtkb3duLCBzY3JvbGxUb3AsIGNvbW1hbmRzLCBleHRyYUNvbW1hbmRzLCBvbkNoYW5nZSwgZGlzcGF0Y2ggfSA9IHVzZUNvbnRleHQoRWRpdG9yQ29udGV4dCk7XG4gIGNvbnN0IHRleHRSZWYgPSBSZWFjdC51c2VSZWY8SFRNTFRleHRBcmVhRWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IGV4ZWN1dGVSZWYgPSBSZWFjdC51c2VSZWY8VGV4dEFyZWFDb21tYW5kT3JjaGVzdHJhdG9yPigpO1xuICBjb25zdCB3YXJwID0gUmVhY3QuY3JlYXRlUmVmPEhUTUxEaXZFbGVtZW50PigpO1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHN0YXRlOiBDb250ZXh0U3RvcmUgPSB7fTtcbiAgICBpZiAod2FycC5jdXJyZW50KSB7XG4gICAgICBzdGF0ZS50ZXh0YXJlYVdhcnAgPSB3YXJwLmN1cnJlbnQgfHwgdW5kZWZpbmVkO1xuICAgICAgd2FycC5jdXJyZW50LnNjcm9sbFRvcCA9IHNjcm9sbFRvcCB8fCAwO1xuICAgIH1cbiAgICBpZiAoZGlzcGF0Y2gpIHtcbiAgICAgIGRpc3BhdGNoKHsgLi4uc3RhdGUgfSk7XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHRleHRSZWYuY3VycmVudCAmJiBkaXNwYXRjaCkge1xuICAgICAgY29uc3QgY29tbWFuZE9yY2hlc3RyYXRvciA9IG5ldyBUZXh0QXJlYUNvbW1hbmRPcmNoZXN0cmF0b3IodGV4dFJlZi5jdXJyZW50KTtcbiAgICAgIGV4ZWN1dGVSZWYuY3VycmVudCA9IGNvbW1hbmRPcmNoZXN0cmF0b3I7XG4gICAgICBkaXNwYXRjaCh7IHRleHRhcmVhOiB0ZXh0UmVmLmN1cnJlbnQsIGNvbW1hbmRPcmNoZXN0cmF0b3IgfSk7XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW10pO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiByZWY9e3dhcnB9IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1hcmVlICR7Y2xhc3NOYW1lIHx8ICcnfWB9IG9uU2Nyb2xsPXtvblNjcm9sbH0+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10ZXh0YH0+XG4gICAgICAgIHtyZW5kZXJUZXh0YXJlYSA/IChcbiAgICAgICAgICBSZWFjdC5jbG9uZUVsZW1lbnQoXG4gICAgICAgICAgICByZW5kZXJUZXh0YXJlYShcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC4uLm90aGVyUHJvcHMsXG4gICAgICAgICAgICAgICAgdmFsdWU6IG1hcmtkb3duLFxuICAgICAgICAgICAgICAgIGF1dG9Db21wbGV0ZTogJ29mZicsXG4gICAgICAgICAgICAgICAgYXV0b0NvcnJlY3Q6ICdvZmYnLFxuICAgICAgICAgICAgICAgIHNwZWxsQ2hlY2s6ICdmYWxzZScsXG4gICAgICAgICAgICAgICAgYXV0b0NhcGl0YWxpemU6ICdvZmYnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS10ZXh0LWlucHV0YCxcbiAgICAgICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICAgICAgV2Via2l0VGV4dEZpbGxDb2xvcjogJ2luaGVyaXQnLFxuICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2gsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgICAgICAgICAgc2hvcnRjdXRzLFxuICAgICAgICAgICAgICAgIHVzZUNvbnRleHQ6IHsgY29tbWFuZHMsIGV4dHJhQ29tbWFuZHMsIGNvbW1hbmRPcmNoZXN0cmF0b3I6IGV4ZWN1dGVSZWYuY3VycmVudCB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcmVmOiB0ZXh0UmVmLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICApXG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPEZyYWdtZW50PlxuICAgICAgICAgICAgPE1hcmtkb3duIHByZWZpeENscz17cHJlZml4Q2xzfSAvPlxuICAgICAgICAgICAgPFRleHRhcmVhIHByZWZpeENscz17cHJlZml4Q2xzfSB7Li4ub3RoZXJQcm9wc30gLz5cbiAgICAgICAgICA8L0ZyYWdtZW50PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59XG4iXX0=