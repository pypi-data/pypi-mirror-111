{"version":3,"sources":["webpack://jupyterlab-zethus/./lib/default_config.js","webpack://jupyterlab-zethus/./lib/editor.js","webpack://jupyterlab-zethus/./lib/icons.js","webpack://jupyterlab-zethus/./lib/index.js","webpack://jupyterlab-zethus/./style/index.css","webpack://jupyterlab-zethus/./style/icon.svg","webpack://jupyterlab-zethus/./style/index.css?b7f0"],"names":[],"mappings":";;;;;;;;;;;;;AAAO;AACP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,yBAAyB,mBAAmB;AAC5C,6BAA6B,uBAAuB;AACpD,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX;AACA;AACA,OAAO;AACP;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC2E;AACf;AACnB;AACW;AACf;AACa;AAClD;AACO,2BAA2B,mEAAc;AAChD;AACA,8BAA8B;AAC9B;AACA;AACA,0BAA0B,8DAAe;AACzC,0BAA0B,8CAAU;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,0CAA0C,6BAA6B,EAAE;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,wEAAqB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,EAAE,YAAY,cAAc,UAAU,yBAAyB,QAAQ,6BAA6B;AACxJ;AACA,kEAAkE,cAAc;AAChF;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,wDAAwD,UAAU,gBAAgB,EAAE;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,+DAAc;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,mEAAgB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,YAAY;AAC1D,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,4BAA4B,qEAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,uBAAuB,mDAAM,IAAI;AAClE;AACA;;;;;;;;;;;;;;;;;;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACoD;AACN;AACvC,uBAAuB,8DAAO;AACrC;AACA,YAAY,oDAAa;AACzB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC0D;AACL;AACS;AACb;AACc;AACrB;AACI;AACL;AACJ;AACT;AAC5B;AACA;AACA;AACA;AACO,2BAA2B,oDAAK;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,wEAAmB,EAAE,oEAAe,EAAE,yEAAgB;AACrE,eAAe,2DAAS;AACxB;AACA;AACA;AACA,iEAAe,MAAM,EAAC;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,wBAAwB,+DAAa,EAAE,YAAY;AACnD;AACA;AACA,wBAAwB,kDAAa;AACrC;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,oDAAoD,mBAAmB,IAAI,uBAAuB;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,0BAA0B,8CAA8C;AACxE;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,8CAAU;AACxB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,cAAc,8CAAU;AACxB;AACA,KAAK;AACL;AACA;AACA,cAAc,8CAAU;AACxB;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,IAAI,oEAAgB;AACpB;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI,oEAAgB;AACpB;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxKA;AACsH;AAC7B;AACW;AACpG,8BAA8B,mFAA2B,CAAC,wGAAqC;AAC/F,0BAA0B,kFAAiC;AAC3D;AACA,mDAAmD,kEAAkE;AACrH;AACA,iEAAe,uBAAuB,EAAC;;;;;;;;;;;;;;;;ACTvC,iEAAe,8dAA8d,E;;;;;;;;;;;;;;;;;;ACApZ;AACzF,YAAuF;;AAEvF;;AAEA;AACA;;AAEA,aAAa,0GAAG,CAAC,mFAAO;;;;AAIxB,iEAAe,0FAAc,MAAM,E","file":"lib_index_js.b0201e5b2c0cfa4b1e86.js","sourcesContent":["export const default_config = (defaultROSEndpoint, defaultROSPKGSEndpoint) => {\n    return `{\n        \"panels\": {\n          \"sidebar\": {\n            \"display\": true,\n            \"collapsed\": false\n          },\n          \"header\": {\n            \"display\": true\n          },\n          \"info\": {\n            \"display\": true,\n            \"collapsed\": true\n          }\n        },\n        \"ros\": {\n          \"endpoint\": \"${defaultROSEndpoint}\",\n          \"pkgsEndpoint\": \"${defaultROSPKGSEndpoint}\"\n        },\n        \"infoTabs\": [],\n        \"visualizations\": [],\n        \"globalOptions\": {\n          \"display\": true,\n          \"backgroundColor\": {\n            \"display\": true,\n            \"value\": 15790320\n          },\n          \"fixedFrame\": {\n            \"display\": true,\n            \"value\": \"world\"\n          },\n          \"grid\": {\n            \"display\": true,\n            \"size\": 30,\n            \"divisions\": 30,\n            \"color\": 11184810,\n            \"centerlineColor\": 7368816\n          }\n        },\n        \"tools\": {\n          \"mode\": \"controls\",\n          \"controls\": {\n            \"display\": false,\n            \"enabled\": true\n          },\n          \"measure\": {\n            \"display\": false\n          },\n          \"custom\": []\n        }\n      }`;\n};\n","// Copyright 2018 Wolf Vollprecht\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { ABCWidgetFactory, DocumentWidget } from '@jupyterlab/docregistry';\nimport { PathExt, PageConfig } from '@jupyterlab/coreutils';\nimport { Widget } from '@lumino/widgets';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { zethusIcon } from './icons';\nimport { default_config } from './default_config';\nlet zethusEditorId = 0;\nexport class ZethusWidget extends DocumentWidget {\n    constructor(options, defaultROSEndpoint, defaultROSPKGSEndpoint) {\n        super(Object.assign({}, options));\n        this.countSetConfig = 0;\n        // private _editor : any;\n        this._ready = new PromiseDelegate();\n        this.title.icon = zethusIcon;\n        zethusEditorId += 1;\n        this.zethusId = zethusEditorId;\n        this.context = options['context'];\n        this._onTitleChanged();\n        this.context.pathChanged.connect(this._onTitleChanged, this);\n        this.context.ready.then(() => {\n            this._onContextReady();\n        });\n        this._defaultROSEndpoint = defaultROSEndpoint;\n        this._defaultROSPKGSEndpoint = defaultROSPKGSEndpoint;\n        // this.context.ready.then(() => { this._handleDirtyStateNew(); });\n        window.onmessage = (event) => {\n            if (event.data && event.data === 'save') {\n                event.preventDefault();\n                this.context.save();\n            }\n        };\n    }\n    loadEditor(state) {\n        var _a;\n        const baseUrl = PageConfig.getBaseUrl();\n        if (!this.iframe) {\n            this.iframe = document.createElement('iframe');\n            this.iframe.className = 'jp-iframe-zethus';\n            const q = encodeURIComponent(JSON.stringify(state));\n            this.iframe.src =\n                baseUrl +\n                    `zethus/app/index.html?config=${q}&zethusId=${this.zethusId}&bridge=${this._defaultROSEndpoint}&pkgs=${this._defaultROSPKGSEndpoint}`;\n            this.content.node.appendChild(this.iframe);\n            window.document.addEventListener(`ZethusUpdateConfig${this.zethusId}`, (e) => {\n                if (this.countSetConfig <= 0) {\n                    this._saveToContext(e.detail.config);\n                }\n                else {\n                    this.countSetConfig--;\n                }\n            }, false);\n        }\n        else {\n            this.countSetConfig++;\n            const event = new CustomEvent('SetConfig', { detail: { config: state } });\n            (_a = this.iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.dispatchEvent(event);\n        }\n    }\n    // protected onResize(msg: Widget.ResizeMessage): void {}\n    _onContextReady() {\n        const contextModel = this.context.model;\n        if (this.context.model.toString() === '') {\n            this.context.model.fromString(default_config(this._defaultROSEndpoint, this._defaultROSPKGSEndpoint));\n        }\n        // Set the editor model value.\n        this._onContentChanged();\n        contextModel.contentChanged.connect(this._onContentChanged, this);\n        this._ready.resolve(void 0);\n    }\n    /**\n     * Handle a change to the title.\n     */\n    _onTitleChanged() {\n        this.title.label = PathExt.basename(this.context.localPath);\n    }\n    _onContentChanged() {\n        try {\n            const editor_value = this.context.model.toString();\n            const state = JSON.parse(editor_value);\n            console.log('Loading editor from content changed!');\n            this.loadEditor(state);\n        }\n        catch (e) {\n            // maybe empty string/\n        }\n    }\n    _saveToContext(content) {\n        console.log('Saving content: ', content);\n        this.context.ready.then(() => {\n            this.context.model.fromString(JSON.stringify(content, null, 4));\n        });\n    }\n    // private _onModelStateChangedNew(sender: DocumentRegistry.IModel, args: IChangedArgs<any>): void {\n    //     // if (args.name === 'dirty') {\n    //     //     this._handleDirtyStateNew();\n    //     // }\n    // }\n    // private _handleDirtyStateNew() : void {\n    //     // if (this.context.model.dirty) {\n    //     //     this.title.className += ` ${DIRTY_CLASS}`;\n    //     // } else {\n    //     //     this.title.className = this.title.className.replace(DIRTY_CLASS, '');\n    //     // }\n    // }\n    onBeforeDetach(msg) {\n        // ReactDOM.unmountComponentAtNode(this.node);\n    }\n    /**\n     * A promise that resolves when the zethus viewer is ready.\n     */\n    get ready() {\n        return this._ready.promise;\n    }\n}\n/**\n * A widget factory for drawio.\n */\nexport class ZethusFactory extends ABCWidgetFactory {\n    /**\n     * Create a new widget given a context.\n     */\n    constructor(options, defaultROSEndpoint, defaultROSPKGSEndpoint) {\n        super(options);\n        this.defaultROSEndpoint = defaultROSEndpoint;\n        this.defaultROSPKGSEndpoint = defaultROSPKGSEndpoint;\n    }\n    createNewWidget(context) {\n        return new ZethusWidget({ context, content: new Widget() }, this.defaultROSEndpoint, this.defaultROSPKGSEndpoint);\n    }\n}\n","// Copyright 2018 Wolf Vollprecht\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport zethusIconSvg from '../style/icon.svg';\nexport const zethusIcon = new LabIcon({\n    name: 'jupyterlab-zethus:icon',\n    svgstr: zethusIconSvg\n});\n","// Copyright 2018 Wolf Vollprecht\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { ILayoutRestorer } from '@jupyterlab/application';\nimport { WidgetTracker } from '@jupyterlab/apputils';\nimport { IFileBrowserFactory } from '@jupyterlab/filebrowser';\nimport { ILauncher } from '@jupyterlab/launcher';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { Token } from '@lumino/coreutils';\nimport { Mode } from '@jupyterlab/codemirror';\nimport { ZethusFactory } from './editor';\nimport { zethusIcon } from './icons';\nimport '../style/index.css';\n/**\n * The name of the factory that creates editor widgets.\n */\nconst FACTORY = 'Zethus';\nexport const IZethusTracker = new Token('zethus/tracki');\n/**\n * The editor tracker extension.\n */\nconst plugin = {\n    activate,\n    id: 'jupyterlab-zethus:plugin',\n    requires: [IFileBrowserFactory, ILayoutRestorer, ISettingRegistry],\n    optional: [ILauncher],\n    provides: IZethusTracker,\n    autoStart: true\n};\nexport default plugin;\n// function activate(\n//   app: JupyterFrontEnd,\n//   browserFactory: IFileBrowserFactory,\n//   restorer: ILayoutRestorer,\n//   menu: IMainMenu,\n//   palette: ICommandPalette,\n//   launcher: ILauncher | null\n// ): IDrawioTracker {\nfunction activate(app, browserFactory, restorer, settingRegistry, launcher) {\n    const namespace = 'zethus';\n    const { commands } = app;\n    const tracker = new WidgetTracker({ namespace });\n    let defaultROSEndpoint = '';\n    let defaultROSPKGSEndpoint = '';\n    const factory = new ZethusFactory({\n        name: FACTORY,\n        fileTypes: ['zethus'],\n        defaultFor: ['zethus']\n    }, defaultROSEndpoint, defaultROSPKGSEndpoint);\n    const updateSettings = (settings) => {\n        defaultROSEndpoint = settings.get('defaultROSEndpoint').composite;\n        defaultROSPKGSEndpoint = settings.get('defaultROSPKGSEndpoint')\n            .composite;\n        console.log(`Updating ROS Endpoint to --> ${defaultROSEndpoint}, ${defaultROSPKGSEndpoint}`);\n        factory.defaultROSEndpoint = defaultROSEndpoint;\n        factory.defaultROSPKGSEndpoint = defaultROSPKGSEndpoint;\n    };\n    Promise.all([\n        settingRegistry.load('jupyterlab-zethus:settings'),\n        app.restored\n    ])\n        .then(([settings]) => {\n        updateSettings(settings);\n        settings.changed.connect(updateSettings);\n    })\n        .catch((reason) => {\n        console.error(reason.message);\n    });\n    /**\n     * Whether there is an active Zethus viewer.\n     */\n    function isEnabled() {\n        return (tracker.currentWidget !== null &&\n            tracker.currentWidget === app.shell.currentWidget);\n    }\n    const zethusCSSSelector = '.jp-DirListing-item[title$=\".zethus\"]';\n    app.contextMenu.addItem({\n        command: 'zethus:launch-simulation',\n        selector: zethusCSSSelector,\n        rank: 1\n    });\n    // Handle state restoration.\n    restorer.restore(tracker, {\n        command: 'docmanager:open',\n        args: widget => ({ path: widget.context.path, factory: FACTORY }),\n        name: widget => widget.context.path\n    });\n    factory.widgetCreated.connect((sender, widget) => {\n        // Notify the instance tracker if restore data needs to update.\n        widget.context.pathChanged.connect(() => {\n            tracker.save(widget);\n        });\n        tracker.add(widget);\n    });\n    app.docRegistry.addWidgetFactory(factory);\n    // Function to create a new untitled diagram file, given\n    // the current working directory.\n    const createNewZethus = (cwd) => {\n        return commands\n            .execute('docmanager:new-untitled', {\n            path: cwd,\n            type: 'file',\n            ext: '.zethus'\n        })\n            .then(model => {\n            return commands.execute('docmanager:open', {\n                path: model.path,\n                factory: FACTORY\n            });\n        });\n    };\n    app.docRegistry.addFileType({\n        name: 'zethus',\n        displayName: 'Zethus File',\n        mimeTypes: ['application/json'],\n        extensions: ['.zethus'],\n        icon: zethusIcon,\n        fileFormat: 'text'\n    });\n    app.docRegistry.addFileType({\n        name: 'roslaunch',\n        displayName: 'ROS Launch File',\n        mimeTypes: ['application/xml'],\n        extensions: ['.launch'],\n        icon: zethusIcon,\n        fileFormat: 'text'\n    });\n    commands.addCommand('zethus:launch', {\n        label: 'Zethus',\n        icon: zethusIcon,\n        caption: 'Launch the Zethus viewer',\n        execute: () => {\n            const cwd = browserFactory.defaultBrowser.model.path;\n            return createNewZethus(cwd);\n        },\n        isEnabled\n    });\n    // Add a launcher item if the launcher is available.\n    if (launcher) {\n        launcher.add({\n            command: 'zethus:launch',\n            rank: 1,\n            category: 'Robotics'\n        });\n    }\n    Mode.getModeInfo().push({\n        name: 'ROS Launch',\n        mime: 'application/xml',\n        mode: 'xml',\n        ext: ['launch']\n    });\n    Mode.getModeInfo().push({\n        name: 'Zethus',\n        mime: 'application/json',\n        mode: 'json',\n        ext: ['zethus']\n    });\n    return tracker;\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../node_modules/css-loader/dist/cjs.js!./base.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\\n\", \"\",{\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\",\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"120\\\" height=\\\"120\\\" viewBox=\\\"0 0 120 120\\\"><path class=\\\"jp-icon3 jp-icon-selectable\\\" fill=\\\"#616161\\\" d=\\\"M27.87475805 65.8655666l14.3661193 24.88603303L56.60900197 65.8655666zM68.87956088 44.61116983L59.9999997 29.23236345H6.72263264l8.87956118 15.37880638zM92.12524136 54.13443904l-14.3661193-24.8840277-14.36812462 24.8840277zM51.12043853 75.38883581L59.9999997 90.7676422h53.27736707l-8.87956118-15.37880638z\\\"/></svg>\";","import api from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../node_modules/css-loader/dist/cjs.js!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};"],"sourceRoot":""}