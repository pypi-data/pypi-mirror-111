{"version":3,"sources":["webpack://WebComponents/./runestone/common/js/renderComponent.js","webpack://WebComponents/./runestone/selectquestion/js/selectone.js"],"names":["async","renderRunestoneComponent","componentSrc","whereDiv","moreOpts","replace","eBookConfig","app","basecourse","jQuery","html","window","edList","componentKind","$","data","opt","orig","lang","useRunestoneServices","graderactive","python3","key","component_factory","alert","res","multiGrader","gradingContainer","divid","SelectOne","opts","super","this","origOpts","questions","proficiency","minDifficulty","maxDifficulty","points","autogradable","not_seen_ever","selector_id","first","attr","primaryOnly","ABExperiment","toggleOptions","toggleLabels","id","self","primary","AB","timedWrapper","selectorId","console","log","request","Request","method","headers","jsonHeaders","body","JSON","stringify","response","fetch","htmlsrc","json","indexOf","Error","timed","hdiv","ret","find","origId","document","getElementById","css","display","appendTo","rdict","question","createTimedComponent","assessmentTaken","component","rqa","realComponent","containerDiv","trim","split","t","length","i","toggleQuestionSubstring","toggleQuestionType","toggleQuestions","toggleUI","toggleQuestionTypes","getToggleSrc","slice","includes","toggleFirstID","hide","toggleQuestionSelect","options","value","addEventListener","togglePreview","parentElement","bind","toggleQuestionID","parentID","getElementsByTagName","selectedQuestion","selectedIndex","closeButton","createElement","text","addClass","click","event","append","setButton","toggleSet","currentType","selectedType","transferButton","toggleTransfer","show","innerHTML","currentParsonsClass","currentBlockIndent","indentCount","indent","parsonsLine","count","currentParsons","querySelectorAll","getElementsByClassName","parsonsLines","p","classList","parseInt","style","left","d","l","childNodes","nodeName","htmlsrcFormer","htmlsrcLatter","selectquestion","selQuestions","cq","closest","tmp","initialize","err","stack"],"mappings":"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","file":"448.bundle.js?v=82ec6815c037e82221a3","sourcesContent":["import { runestone_import } from \"../../../webpack.index.js\";\n\nexport async function renderRunestoneComponent(componentSrc, whereDiv, moreOpts) {\n    /**\n     *  The easy part is adding the componentSrc to the existing div.\n     *  The tedious part is calling the right functions to turn the\n     *  source into the actual component.\n     */\n    let patt = /..\\/_images/g;\n    componentSrc = componentSrc.replace(\n        patt,\n        `${eBookConfig.app}/books/published/${eBookConfig.basecourse}/_images`\n    );\n    jQuery(`#${whereDiv}`).html(componentSrc);\n\n    if (typeof window.edList === \"undefined\") {\n        window.edList = {};\n    }\n\n    let componentKind = $($(`#${whereDiv} [data-component]`)[0]).data(\n        \"component\"\n    );\n    // Import the JavaScript for this component before proceeding.\n    await runestone_import(componentKind);\n    let opt = {};\n    opt.orig = jQuery(`#${whereDiv} [data-component]`)[0];\n    if (opt.orig) {\n        opt.lang = $(opt.orig).data(\"lang\");\n        opt.useRunestoneServices = true;\n        opt.graderactive = false;\n        opt.python3 = true;\n        if (typeof moreOpts !== \"undefined\") {\n            for (let key in moreOpts) {\n                opt[key] = moreOpts[key];\n            }\n        }\n    }\n\n    if (typeof component_factory === \"undefined\") {\n        alert(\n            \"Error:  Missing the component factory!  Clear you browser cache.\"\n        );\n    } else {\n        if (\n            !window.component_factory[componentKind] &&\n            !jQuery(`#${whereDiv}`).html()\n        ) {\n            jQuery(`#${whereDiv}`).html(\n                `<p>Preview not available for ${componentKind}</p>`\n            );\n        } else {\n            let res = window.component_factory[componentKind](opt);\n            if (componentKind === \"activecode\") {\n                if (moreOpts.multiGrader) {\n                    window.edList[\n                        `${moreOpts.gradingContainer} ${res.divid}`\n                    ] = res;\n                } else {\n                    window.edList[res.divid] = res;\n                }\n            }\n        }\n    }\n}\n\nexport function createTimedComponent(componentSrc, moreOpts) {\n    /* The important distinction is that the component does not really need to be rendered\n    into the page, in fact, due to the async nature of getting the source the list of questions\n    is made and the original html is replaced by the look of the exam.\n    */\n\n    let patt = /..\\/_images/g;\n    componentSrc = componentSrc.replace(\n        patt,\n        `${eBookConfig.app}/books/published/${eBookConfig.basecourse}/_images`\n    );\n\n    let componentKind = $($(componentSrc).find(\"[data-component]\")[0]).data(\n        \"component\"\n    );\n\n    let origId = $(componentSrc).find(\"[data-component]\").first().attr(\"id\");\n\n    // Double check -- if the component source is not in the DOM, then briefly add it\n    // and call the constructor.\n    let hdiv;\n    if (!document.getElementById(origId)) {\n        hdiv = $(\"<div/>\", {\n            css: { display: \"none\" },\n        }).appendTo(\"body\");\n        hdiv.html(componentSrc);\n    }\n    // at this point hdiv is a jquery object\n\n    let ret;\n    let opts = {\n        orig: document.getElementById(origId),\n        timed: true,\n    };\n    if (typeof moreOpts !== \"undefined\") {\n        for (let key in moreOpts) {\n            opts[key] = moreOpts[key];\n        }\n    }\n\n    if (componentKind in window.component_factory) {\n        ret = window.component_factory[componentKind](opts);\n    }\n\n    let rdict = {};\n    rdict.question = ret;\n    return rdict;\n}\n","/**\n * *******************************\n * |docname| - SelectOne Component\n * *******************************\n */\nimport {\n    renderRunestoneComponent,\n    createTimedComponent,\n} from \"../../common/js/renderComponent.js\";\nimport RunestoneBase from \"../../common/js/runestonebase.js\";\nimport \"../css/selectquestion.css\";\n\nexport default class SelectOne extends RunestoneBase {\n    /**\n     * constructor --\n     * Making an instance of a selectone is a bit more complicated because it is\n     * a kind of meta directive.  That is, go to the server and randomly select\n     * a question to display in this spot.  Or, if a student has already seen this question\n     * in the context of an exam retrieve the question they saw in the first place.\n     * Making an API call and waiting for the response is handled asynchronously.\n     * But lots of code is not written with that assumption.  So we do the initialization in\n     * two parts.\n     * 1. Create the object with the usual constructor\n     * 2. call initialize, which returns a promise.  When that promise is resolved\n     * the \"replacement\" component will replace the original selectone component in the DOM.\n     *\n     * @param  {} opts\n     */\n    constructor(opts) {\n        super(opts);\n        this.origOpts = opts;\n        this.questions = $(opts.orig).data(\"questionlist\");\n        this.proficiency = $(opts.orig).data(\"proficiency\");\n        this.minDifficulty = $(opts.orig).data(\"minDifficulty\");\n        this.maxDifficulty = $(opts.orig).data(\"maxDifficulty\");\n        this.points = $(opts.orig).data(\"points\");\n        this.autogradable = $(opts.orig).data(\"autogradable\");\n        this.not_seen_ever = $(opts.orig).data(\"not_seen_ever\");\n        this.selector_id = $(opts.orig).first().attr(\"id\");\n        this.primaryOnly = $(opts.orig).data(\"primary\");\n        this.ABExperiment = $(opts.orig).data(\"ab\");\n        this.toggleOptions = $(opts.orig).data(\"toggleoptions\");\n        this.toggleLabels = $(opts.orig).data(\"togglelabels\");\n        opts.orig.id = this.selector_id;\n    }\n    /**\n     * initialize --\n     * initialize is used so that the constructor does not have to be async.\n     * Constructors should definitely not return promises that would seriously\n     * mess things up.\n     * @return {Promise} Will resolve after component from DB is reified\n     */\n    async initialize() {\n        let self = this;\n        let data = { selector_id: this.selector_id };\n        if (this.questions) {\n            data.questions = this.questions;\n        } else if (this.proficiency) {\n            data.proficiency = this.proficiency;\n        }\n        if (this.minDifficulty) {\n            data.minDifficulty = this.minDifficulty;\n        }\n        if (this.maxDifficulty) {\n            data.maxDifficulty = this.maxDifficulty;\n        }\n        if (this.points) {\n            data.points = this.points;\n        }\n        if (this.autogradable) {\n            data.autogradable = this.autogradable;\n        }\n        if (this.not_seen_ever) {\n            data.not_seen_ever = this.not_seen_ever;\n        }\n        if (this.primaryOnly) {\n            data.primary = this.primaryOnly;\n        }\n        if (this.ABExperiment) {\n            data.AB = this.ABExperiment;\n        }\n        if (this.timedWrapper) {\n            data.timedWrapper = this.timedWrapper;\n        }\n        if (this.toggleOptions) {\n            data.toggleOptions = this.toggleOptions;\n        }\n        if (this.toggleLabels) {\n            data.toggleLabels = this.toggleLabels;\n        }\n        let opts = this.origOpts;\n        let selectorId = this.selector_id;\n        console.log(\"getting question source\");\n        let request = new Request(\"/runestone/ajax/get_question_source\", {\n            method: \"POST\",\n            headers: this.jsonHeaders,\n            body: JSON.stringify(data),\n        });\n        let response = await fetch(request);\n        let htmlsrc = await response.json();\n        if (htmlsrc.indexOf(\"No preview\") >= 0) {\n            alert(\n                `Error: Not able to find a question for ${selectorId} based on the criteria`\n            );\n            throw new Error(`Unable to find a question for ${selectorId}`);\n        }\n        let res;\n        if (opts.timed) {\n            // timed components are not rendered immediately, only when the student\n            // starts the assessment and visits this particular entry.\n            res = createTimedComponent(htmlsrc, {\n                timed: true,\n                selector_id: selectorId,\n                assessmentTaken: opts.assessmentTaken,\n            });\n            // replace the entry in the timed assessment's list of components\n            // with the component created by createTimedComponent\n            for (let component of opts.rqa) {\n                if (component.question == self) {\n                    component.question = res.question;\n                    break;\n                }\n            }\n            self.realComponent = res.question;\n            self.containerDiv = res.question.containerDiv;\n            self.realComponent.selectorId = selectorId;\n        } else {\n            if (data.toggleOptions) {\n                var toggleLabels = data.toggleLabels.replace(\"togglelabels:\", \"\").trim();\n                if (toggleLabels) {\n                    toggleLabels = toggleLabels.split(\",\");\n                    for (var t = 0; t < toggleLabels.length; t++) {\n                        toggleLabels[t] = toggleLabels[t].trim();\n                    }\n                }\n                var toggleQuestions = this.questions.split(\", \");\n                var toggleUI = \"\";\n                // check so that only the first toggle select question on the assignments page has a preview panel created, then all toggle select previews use this same panel\n                if (!document.getElementById(\"component-preview\")) {\n                    toggleUI +=\n                        '<div id=\"component-preview\" class=\"col-md-6 toggle-preview\" style=\"z-index: 999;\">' +\n                            '<div id=\"toggle-buttons\"></div>' +\n                            '<div id=\"toggle-preview\"></div>' +\n                        '</div>';\n                }\n                // dropdown menu containing the question options\n                toggleUI +=\n                    '<label for=\"' +\n                    selectorId +\n                    '-toggleQuestion\" style=\"margin-left: 10px\">Toggle Question:</label><select id=\"' +\n                    selectorId +\n                    '-toggleQuestion\">';\n                var i;\n                var toggleQuestionHTMLSrc;\n                var toggleQuestionSubstring;\n                var toggleQuestionType;\n                var toggleQuestionTypes = [];\n                for (i = 0; i < toggleQuestions.length; i++) {\n                    toggleQuestionHTMLSrc = await this.getToggleSrc(\n                        toggleQuestions[i]\n                    );\n                    toggleQuestionSubstring = toggleQuestionHTMLSrc.split(\n                        'data-component=\"'\n                    )[1];\n                    switch (\n                        toggleQuestionSubstring.slice(\n                            0,\n                            toggleQuestionSubstring.indexOf('\"')\n                        )\n                    ) {\n                        case \"activecode\":\n                            toggleQuestionType = \"Active Write Code\";\n                            break;\n                        case \"clickablearea\":\n                            toggleQuestionType = \"Clickable Area\";\n                            break;\n                        case \"dragndrop\":\n                            toggleQuestionType = \"Drag n Drop\";\n                            break;\n                        case \"fillintheblank\":\n                            toggleQuestionType = \"Fill in the Blank\";\n                            break;\n                        case \"multiplechoice\":\n                            toggleQuestionType = \"Multiple Choice\";\n                            break;\n                        case \"parsons\":\n                            toggleQuestionType = \"Parsons Mixed-Up Code\";\n                            break;\n                        case \"shortanswer\":\n                            toggleQuestionType = \"Short Answer\";\n                            break;\n                    }\n                    toggleQuestionTypes[i] = toggleQuestionType;\n                    toggleUI +=\n                        '<option value=\"' +\n                        toggleQuestions[i] +\n                        '\">';\n                    if (toggleLabels) {\n                        if (toggleLabels[i]) {\n                            toggleUI += toggleLabels[i];\n                        }\n                        else {\n                            toggleUI += toggleQuestionType +\n                            \" - \" +\n                            toggleQuestions[i];\n                        }\n                    }\n                    else {\n                        toggleUI += toggleQuestionType +\n                        \" - \" +\n                        toggleQuestions[i];\n                    }\n                    if ((i == 0) && (data.toggleOptions.includes(\"lock\"))) {\n                        toggleUI += \" (only this question will be graded)\";\n                    }\n                    toggleUI += \"</option>\";\n                }\n                toggleUI +=\n                    '</select><div id=\"' +\n                    selectorId +\n                    '-toggleSelectedQuestion\">';\n                var toggleFirstID = htmlsrc.split('id=\"')[1];\n                toggleFirstID = toggleFirstID.split('\"')[0];\n                htmlsrc = toggleUI + htmlsrc + \"</div>\";\n            }\n            // just render this component on the page in its usual place\n            await renderRunestoneComponent(htmlsrc, selectorId, {\n                selector_id: selectorId,\n                useRunestoneServices: true,\n            });\n            if (data.toggleOptions) {\n                $(\"#component-preview\").hide();\n                var toggleQuestionSelect = document.getElementById(\n                    selectorId + \"-toggleQuestion\"\n                );\n                for (i = 0; i < toggleQuestionSelect.options.length; i++) {\n                    if (\n                        toggleQuestionSelect.options[i].value == toggleFirstID\n                    ) {\n                        toggleQuestionSelect.value = toggleFirstID;\n                        $(\"#\" + selectorId).data(\n                            \"toggle_current\",\n                            toggleFirstID\n                        );\n                        $(\"#\" + selectorId).data(\n                            \"toggle_current_type\",\n                            toggleQuestionTypes[0]\n                        );\n                        break;\n                    }\n                }\n                toggleQuestionSelect.addEventListener(\n                    \"change\",\n                    async function () {\n                        await this.togglePreview(\n                            toggleQuestionSelect.parentElement.id,\n                            data.toggleOptions,\n                            toggleQuestionTypes\n                        );\n                    }.bind(this)\n                );\n            }\n        }\n        return response;\n    }\n\n    // retrieve html source of a question, for use in various toggle functionalities\n    async getToggleSrc(toggleQuestionID) {\n        let request = new Request(\n            \"/runestone/admin/htmlsrc?acid=\" + toggleQuestionID,\n            {\n                method: \"GET\",\n            }\n        );\n        let response = await fetch(request);\n        let htmlsrc = await response.json();\n        return htmlsrc;\n    }\n\n    // on changing the value of toggle select dropdown, render selected question in preview panel, add appropriate buttons, then make preview panel visible\n    async togglePreview(parentID, toggleOptions, toggleQuestionTypes) {\n        $(\"#toggle-buttons\").html(\"\");\n        var parentDiv = document.getElementById(parentID);\n        var toggleQuestionSelect = parentDiv.getElementsByTagName(\"select\")[0];\n        var selectedQuestion =\n            toggleQuestionSelect.options[toggleQuestionSelect.selectedIndex]\n                .value;\n        var htmlsrc = await this.getToggleSrc(selectedQuestion);\n        renderRunestoneComponent(htmlsrc, \"toggle-preview\", {\n            selector_id: \"toggle-preview\",\n            useRunestoneServices: true,\n        });\n\n        // add \"Close Preview\" button to the preview panel\n        let closeButton = document.createElement(\"button\");\n        $(closeButton).text(\"Close Preview\");\n        $(closeButton).addClass(\"btn btn-default\");\n        $(closeButton).click(function (event) {\n            $(\"#toggle-preview\").html(\"\");\n            toggleQuestionSelect.value = $(\"#\" + parentID).data(\n                \"toggle_current\"\n            );\n            $(\"#component-preview\").hide();\n        });\n        $(\"#toggle-buttons\").append(closeButton);\n\n        // if \"lock\" is not in toggle options, then allow adding more buttons to the preview panel \n        if (!(toggleOptions.includes(\"lock\"))) {\n            let setButton = document.createElement(\"button\");\n            $(setButton).text(\"Select this Problem\");\n            $(setButton).addClass(\"btn btn-primary\");\n            $(setButton).click(\n                async function () {\n                    await this.toggleSet(parentID, selectedQuestion, htmlsrc, toggleQuestionTypes);\n                    $(\"#component-preview\").hide();\n                }.bind(this)\n            );\n            $(\"#toggle-buttons\").append(setButton);\n\n            // if \"transfer\" in toggle options, and if current question type is Parsons and selected question type is active code, then add \"Transfer\" button to preview panel\n            if (toggleOptions.includes(\"transfer\")) {\n                var currentType = $(\"#\" + parentID).data(\"toggle_current_type\");\n                var selectedType = toggleQuestionTypes[toggleQuestionSelect.selectedIndex];\n                if ((currentType == \"Parsons Mixed-Up Code\") && (selectedType == \"Active Write Code\")) {\n                    let transferButton = document.createElement(\"button\");\n                    $(transferButton).text(\"Transfer Response\");\n                    $(transferButton).addClass(\"btn btn-primary\");\n                    $(transferButton).click(\n                        async function () {\n                            await this.toggleTransfer(parentID, selectedQuestion, htmlsrc, toggleQuestionTypes);\n                        }.bind(this)\n                    );\n                    $(\"#toggle-buttons\").append(transferButton);\n                }\n            }\n        }\n\n        $(\"#component-preview\").show();\n    }\n\n    // on clicking \"Select this Problem\" button, close preview panel, replace current question in assignments page with selected question, and send request to update grading database\n    async toggleSet(parentID, selectedQuestion, htmlsrc, toggleQuestionTypes) {\n        var selectorId = parentID + \"-toggleSelectedQuestion\";\n        var toggleQuestionSelect = document.getElementById(parentID).getElementsByTagName(\"select\")[0];\n        document.getElementById(selectorId).innerHTML = \"\"; // need to check whether this is even necessary\n        await renderRunestoneComponent(htmlsrc, selectorId, {\n            selector_id: selectorId,\n            useRunestoneServices: true,\n        });\n        let request = new Request(\n            \"/runestone/ajax/update_selected_question?metaid=\" +\n                parentID +\n                \"&selected=\" +\n                selectedQuestion,\n            {}\n        );\n        await fetch(request);\n        $(\"#toggle-preview\").html(\"\");\n        $(\"#\" + parentID).data(\"toggle_current\", selectedQuestion);\n        $(\"#\" + parentID).data(\"toggle_current_type\", toggleQuestionTypes[toggleQuestionSelect.selectedIndex]);\n    }\n\n    // on clicking \"Transfer\" button, extract the current text and indentation of the Parsons blocks in the answer space, then paste that into the selected active code question\n    async toggleTransfer(parentID, selectedQuestion, htmlsrc, toggleQuestionTypes) {\n        // retrieve all Parsons lines within the answer space and loop through this list\n        var currentParsons = document.getElementById(parentID + \"-toggleSelectedQuestion\").querySelectorAll(\"div[class^='answer']\")[0].getElementsByClassName(\"prettyprint lang-py\");\n        var currentParsonsClass;\n        var currentBlockIndent;\n        var indentCount\n        var indent;\n        var parsonsLine;\n        var parsonsLines = ``;\n        var count;\n        for (var p = 0; p < currentParsons.length; p++) {\n            indentCount = 0;\n            indent = \"\";\n            // for Parsons blocks that have built-in indentation in their lines\n            currentParsonsClass = currentParsons[p].classList[2];\n            if (currentParsonsClass) {\n                if (currentParsonsClass.includes(\"indent\")) {\n                    indentCount = parseInt(indentCount) + parseInt(currentParsonsClass.slice(6,currentParsonsClass.length));\n                }\n            }\n            // for Parsons answer spaces with vertical lines that allow student to define their own line indentation\n            currentBlockIndent = currentParsons[p].parentElement.parentElement.style.left;\n            if (currentBlockIndent) {\n                indentCount = parseInt(indentCount) + parseInt(currentBlockIndent.slice(0,currentBlockIndent.indexOf(\"px\")) / 30);\n            }\n            for (var d = 0; d < indentCount; d++) {\n                indent += \"    \";\n            }\n            // retrieve each text snippet of each Parsons line and loop through this list\n            parsonsLine = currentParsons[p].getElementsByTagName(\"span\");\n            count = 0;\n            for (var l = 0; l < parsonsLine.length; l++) {\n                if (parsonsLine[l].childNodes[0].nodeName == \"#text\") { // Parsons blocks have differing amounts of hierarchy levels (spans within spans)\n                    if ((p == 0) && (count == 0)) { // need different check than l == 0 because the l numbering doesn't align with location within line due to inconsistent span heirarchy\n                        parsonsLines += indent + parsonsLine[l].innerHTML;\n                        count++;\n                    }\n                    else if (count != 0) {\n                        parsonsLines += parsonsLine[l].innerHTML;\n                        count++;\n                    }\n                    else {\n                        parsonsLines = parsonsLines + `\n                            ` + indent + parsonsLine[l].innerHTML;\n                        parsonsLines = parsonsLines.replace(\"                            \", \"\");\n                        count++;\n                    }\n                }\n            }\n        }\n        // replace all existing code within selected active code question with extracted Parsons text\n        var htmlsrcFormer = htmlsrc.slice(0, htmlsrc.indexOf(\"<textarea\") + htmlsrc.split(\"<textarea\")[1].indexOf(\">\") + 10);\n        var htmlsrcLatter = htmlsrc.slice(htmlsrc.indexOf(\"</textarea>\"), htmlsrc.length);\n        htmlsrc = htmlsrcFormer + parsonsLines + htmlsrcLatter;\n\n        await this.toggleSet(parentID, selectedQuestion, htmlsrc, toggleQuestionTypes);\n        $(\"#component-preview\").hide();\n    }\n}\n\n\nif (typeof window.component_factory === \"undefined\") {\n    window.component_factory = {};\n}\n\nwindow.component_factory.selectquestion = function (opts) {\n        return new SelectOne(opts);\n};\n\n/*\n * When the page is loaded and the login checks are complete find and render\n * each selectquestion component that is not part of a timedAssessment.\n **/\n$(document).bind(\"runestone:login-complete\", async function () {\n    let selQuestions = document.querySelectorAll(\n        \"[data-component=selectquestion]\"\n    );\n    for (let cq of selQuestions) {\n        try {\n            if ($(cq).closest(\"[data-component=timedAssessment]\").length == 0) {\n                // If this element exists within a timed component, don't render it here\n                let tmp = new SelectOne({ orig: cq });\n                await tmp.initialize();\n            }\n        } catch (err) {\n            console.log(`Error rendering New Exercise ${cq.id}\n                         Details: ${err}`);\n            console.log(err.stack);\n        }\n    }\n});\n"],"sourceRoot":""}