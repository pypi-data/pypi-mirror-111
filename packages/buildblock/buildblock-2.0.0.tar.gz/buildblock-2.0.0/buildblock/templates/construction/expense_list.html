{% extends "construction/base.html" %}
{% load static i18n humanize base_tag construction_tag mathfilters %}

{% block page_title %}
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            {% if is_editor %}
            <div class="page-title-right">
                <a href="#" data-toggle="modal" data-target="#add_expense_modal_3" data-dismiss="modal" class="btn btn-danger btn-rounded mb-3 mr-1"><i class="dripicons-plus"></i> Expense</a>
                <a href="#" data-toggle="modal" data-target="#add_multi_expense_modal" data-dismiss="modal" class="btn btn-danger btn-rounded mb-3"><i class="dripicons-plus"></i> Multiple Expenses</a>
            </div>
            {% endif %}
            <h4 class="page-title">{{page_title}}</h4>
        </div>
    </div>
</div>
<!-- end page title -->
{% endblock page_title %}


{% block content %}
<div class="row">
    <div class="col-12 hidden_lg pb-2">
        {% if is_editor %}
        <a href="#" data-toggle="modal" data-target="#add_expense_modal_3" class="btn btn-danger w-100 mb-1"><i class="dripicons-plus"></i> Expense</a>
        <a href="#" data-toggle="modal" data-target="#add_multi_expense_modal" class="btn btn-danger w-100"><i class="dripicons-plus"></i> Multiple Expenses</a>
        {% endif %}
    </div>
    <div class="col-12">
        <div class="table-responsive">
            <table class="table table-condensed dataTable table_expense mt-4">
                <colgroup>
                    <col width="140">
                    <col width="48">
                    <col width="">
                    <col width="">
                    <col width="">
                    <col width="">
                    <col width="">
                    {% if is_editor %}
                    <col width="200">
                    {% endif %}
                </colgroup>
                <thead class="thead-dark">
                    <tr>
                        <th>Date</th>
                        <th></th>
                        <th>Item</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Amount</th>
                        {% if is_editor %}
                        <th></th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr>
                        <td>{{expense.date|date:'Y-m-d'}}</td>
                        <td>
                            {% if expense.attachment %}
                            <a href="{{expense.attachment.url}}" target="_blank"><i class="mdi mdi-link-variant text-white font-16"></i></a>
                            {% endif %}
                        </td>
                        <td>
                            <b class="text-white mr-1">{{expense.item}}</b>
                            {% if expense.description %}
                            <a class="text-muted ml-1"
                                data-container="body"
                                data-trigger="hover"
                                data-toggle="popover"
                                data-placement="bottom"
                                data-content="{{expense.description}}">
                                <i class="mdi mdi-comment-processing"></i>
                            </a>
                            {% endif %}
                        </td>
                        <td>{{expense.get_category_display}}</td>
                        <td>{{expense.quantity}}</td>
                        <td><span class="dollar_sign">
                            {{expense.amount|filter_safe_money_read_from_db|intdiv:expense.quantity|intcomma}}
                        </span></td>
                        <td><span class="dollar_sign">{{expense.amount|filter_safe_money_read_from_db|intcomma}}</span></td>
                        {% if is_editor %}
                        <td class="text-right">
                            <a class="btn btn-sm btn-link text-muted" href="#" data-toggle="modal" data-target="#update_expense_modal_2" onclick="updateExpenseData('{{expense.id}}','{{expense.item}}','{{expense.category}}','{{expense.date|date:'Y-m-d'}}','{{expense.quantity}}','{{expense.amount}}','{{expense.attachment}}','{{expense.description}}');"><i class="dripicons-document-edit"></i></a>
                            <a class="btn btn-sm btn-link text-muted" href="#" data-toggle="modal" data-target="#delete_expense_modal" onclick="deleteExpenseData('{{expense.id}}','expense');"><i class="dripicons-trash"></i></a>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td class="text-center" colspan="100%">No Expenses</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% include "base/pagination.html" with paginator=paginator add_css="page_nav_dark" sign_align="end" %}
{% endblock content %}

{% block modal %}
{% if is_editor %}
{% include 'construction/partials/expense_update_modal.html' %}
{% include 'construction/partials/multi_expense_modal.html' %}
{% endif %}
{% endblock %}

{% block third_party %}
{% include "base/load_datatable.html" %}
{% endblock third_party %}
