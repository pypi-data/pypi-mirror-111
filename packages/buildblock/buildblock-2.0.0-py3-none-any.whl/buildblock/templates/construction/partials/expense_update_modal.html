{% load static i18n base_tag construction_tag %}
{% get_expense_category_list as EXPENSE_CATEGORY_LIST %}
<div id="update_expense_modal_1" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="update_expense_modal_label_1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="update_expense_modal_label_1">Edit personnel expense</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <form method="post"
                  action="{% url 'construction:personnel-expense-update' %}"
                  enctype="multipart/form-data">
                {% csrf_token %}
                {% autoescape off %}
                <input type="hidden" name="return_url" value="{{request.get_full_path}}">
                <input type="hidden" name="expense_id"/>
                <input type="hidden" name="worker_id"/>
                <div class="modal-body">
                    <div class="form-group mb-4">
                        <p class="font-12 text-muted">WORKER</p>
                        <input type="text" name="worker_name" class="form-control" disabled>
                    </div>
                    <div class="row">
                        <div class="col-6 pr-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">WORKING HOURS</p>
                                <input type="number" class="form-control" name="work_hours" required>
                            </div>
                        </div>
                        <div class="col-6 pl-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">PAYMENT (cent)</p>
                                <input type="text" class="form-control" name="amount" required>
                            </div>
                        </div>
                        <div class="col-8 pr-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">WORK DATE</p>
                                <input type="date" class="form-control date" name="date" id="per_expense_edit_date_picker" data-toggle="date-picker" data-single-date-picker="true" required>
                            </div>
                        </div>
                        <div class="col-4 pl-1 text-center">
                            <div class="form-group delete_switch mb-1">
                                <p class="font-12 text-muted">Payment Check</p>
                                <input type="checkbox" id="per_expense_edit_paid" data-switch="info" name="payment_check" value="paid"/>
                                <label class="mt-1" for="per_expense_edit_paid" data-on-label="Paid" data-off-label="Not Paid"></label>
                            </div>
                        </div>
                        <div class="col-8 pr-1">
                            <div class="form-group mb-1">
                                <p class="font-12 text-muted">ATTACHMENT (optional)</p>
                                <input type="file" class="form-control" name="attachment">
                            </div>
                        </div>
                        <div class="col-4 pl-1 text-center">
                            <div class="form-group delete_switch mb-1">
                                <p class="font-12 text-muted">기존파일 삭제</p>
                                <input type="checkbox" id="delete_attach_switch_1" data-switch="danger" name="delete_attach" value="delete"/>
                                <label class="mt-1" for="delete_attach_switch_1" data-on-label="Delete" data-off-label="Keep file"></label>
                            </div>
                        </div>
                        <div class="col-12 mb-4">
                            <span class="font-12 text-muted">※ 새로운 파일을 저장하면 기존의 파일은 삭제되니 유의하시기 바랍니다.</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <p class="font-12 text-muted">DESCRIPTION (optional)</p>
                        <textarea name="description" class="form-control" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer" style="justify-content: space-between;">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <input type='submit' class='btn btn-success' value='Save' />
                </div>
                {% endautoescape %}
            </form>
        </div>
    </div>
</div>

<div id="update_expense_modal_2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="update_expense_modal_label_2" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="update_expense_modal_label_2">Edit expense</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <form method="post"
                  action="{% url 'construction:expense-update' %}"
                  enctype="multipart/form-data">
                {% csrf_token %}
                {% autoescape off %}
                <input type="hidden" name="return_url" value="{{request.get_full_path}}">
                <input type="hidden" name="expense_id"/>
                <div class="modal-body">
                    <div class="form-group mb-4">
                        <p class="font-12 text-muted">CATEGORY</p>
                        <select class="form-control" name="category" required>
                            {% for value, display in EXPENSE_CATEGORY_LIST %}
                            <option value="{{value}}">{{display}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-8 pr-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">ITEM</p>
                                <input type="text" name="item" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-4 pl-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">QUANTITY (optional)</p>
                                <input type="number" class="form-control" name="quantity">
                            </div>
                        </div>
                        <div class="col-6 pr-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">TOTAL AMOUNT (cent)</p>
                                <input type="text" class="form-control" name="amount" required>
                            </div>
                        </div>
                        <div class="col-6 pl-1">
                            <div class="form-group mb-4">
                                <p class="font-12 text-muted">DATE</p>
                                <input type="date" class="form-control date" name="date" id="expense_date_picker" data-toggle="date-picker" data-single-date-picker="true" required>
                            </div>
                        </div>
                        <div class="col-8 pr-1">
                            <div class="form-group mb-1">
                                <p class="font-12 text-muted">ATTACHMENT (optional)</p>
                                <input type="file" class="form-control" name="attachment">
                            </div>
                        </div>
                        <div class="col-4 pl-1 text-center">
                            <div class="form-group delete_switch mb-1">
                                <p class="font-12 text-muted">기존파일 삭제</p>
                                <input type="checkbox" id="delete_attach_switch_2" data-switch="danger" name="delete_attach" value="delete"/>
                                <label class="mt-1" for="delete_attach_switch_2" data-on-label="Delete" data-off-label="Keep file"></label>
                            </div>
                        </div>
                        <div class="col-12 mb-4">
                            <span class="font-12 text-muted">※ 새로운 파일을 저장하면 기존의 파일은 삭제되니 유의하시기 바랍니다.</span>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <p class="font-12 text-muted">DESCRIPTION (optional)</p>
                                <textarea name="description" class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="justify-content: space-between;">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <input type='submit' class='btn btn-success' value='Save' />
                </div>
                {% endautoescape %}
            </form>
        </div>
    </div>
</div>

<div id="delete_expense_modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="expense_delete_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="expense_delete_label">Delete Work</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <form method="POST" action="{% url 'construction:expense-delete' %}">
                {% csrf_token %}
                <input type="hidden" name="expense_id">
                <input type="hidden" name="expense_type">
                <input type="hidden" name="construction_id" value="{{construction.id}}">
                <input type="hidden" name="return_url" value="{{request.get_full_path}}">
                <div class="modal-body text-center">
                    <p class="font-14 my-3">{% blocktrans %} 해당 비용을 삭제하시겠습니까? {% endblocktrans %}</p>
                </div>
                <div class="modal-footer">
                    <input type="submit" value="Delete" class='btn btn-danger'/>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function deleteExpenseData(id, type) {
        var delete_form = $('#delete_expense_modal form');
        delete_form.find('input[name="expense_id"]').val(id);
        delete_form.find('input[name="expense_type"]').val(type);
    };

    function updatePersonnelExpenseData(id, worker_name, worker_id, date, payment_date, work_hours, amount, attachment, description) {
        var update_form = $('#update_expense_modal_1 form');
        update_form.find('input[name="expense_id"]').val(id);
        update_form.find('input[name="worker_id"]').val(worker_id);
        update_form.find('input[name="worker_name"]').val(worker_name);
        update_form.find('input[name="date"]').val(date);
        update_form.find('input[name="work_hours"]').val(work_hours);
        update_form.find('input[name="amount"]').val(amount);
        update_form.find('textarea[name="description"]').val(description);
        if(payment_date=='None'){
            update_form.find('input[name="payment_check"]').attr('checked', false)
        } else {
            update_form.find('input[name="payment_check"]').attr('checked', true)
        }
        if(attachment==''){
            update_form.find('input[name="delete_attach"]').attr('disabled', true)
        } else {
            update_form.find('input[name="delete_attach"]').attr('disabled', false)
        }
    };

    function updateExpenseData(id, item, category, date, quantity, amount, attachment, description) {
        var update_form = $('#update_expense_modal_2 form');
        update_form.find('input[name="expense_id"]').val(id);
        update_form.find('input[name="item"]').val(item);
        update_form.find('select[name="category"]').val(category);
        update_form.find('input[name="date"]').val(date);
        update_form.find('input[name="quantity"]').val(quantity);
        update_form.find('input[name="amount"]').val(amount);
        update_form.find('textarea[name="description"]').val(description);
        if(attachment==''){
            update_form.find('input[name="delete_attach"]').attr('disabled', true)
        } else {
            update_form.find('input[name="delete_attach"]').attr('disabled', false)
        }
    };
</script>
