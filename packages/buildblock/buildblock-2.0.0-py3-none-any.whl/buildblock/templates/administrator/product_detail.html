{% extends "administrator/base.html" %}
{% load static i18n crispy_forms_tags management_tag %}

{% block title %}{{page_title}}{% endblock %}

{% block page_title %}
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <a class="btn btn-sm btn-link text-warning" href="{% url 'administrator:product-update' product.id %}"><i class="dripicons-document-edit"></i> EDIT</a>
                <a class="btn btn-sm btn-link text-danger" href="{% url 'administrator:product-delete' product.id %}"><i class="dripicons-trash"></i> DELETE</a>
                <a class="btn btn-sm btn-link text-dark" href="{% url 'administrator:product-list' %}"><i class="dripicons-list"></i> LIST</a>
            </div>
            <h4 class="page-title">{{page_title}}</h4>
        </div>
    </div>
</div>
<!-- end page title -->
{% endblock page_title %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card manager_product_detail">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-4">
                        <!-- Product image -->
                        <div id="carouselExampleIndicators" class="carousel slide product_img_slide" data-ride="carousel">
                            {% if product.product_images|length > 1 %}
                            <ol class="carousel-indicators">
                                {% for product_image in product.product_images %}
                                <li class="{% if forloop.first %}active{% endif %}"
                                    data-target="#carouselExampleIndicators" data-slide-to="{{forloop.counter}}"></li>
                                {% endfor %}
                            </ol>
                            {% endif %}
                            <div class="carousel-inner" role="listbox">
                                {% for product_image in product.product_images %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <a href="#" data-toggle="modal" data-target="#product_img_modal"
                                       onclick="changeModalImage('{{product_image.title}}','{{product_image.original_image_url}}');">
                                        <img class="d-block img-fluid" src="{{product_image.thumbnail_image_url}}" alt="{{product_image.title}}">
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-6 border-right border-secondary">
                                <label class="font-12 text-gray font-weight-light">ADDRESS</label>
                                <p class="text-white font-16">{{product.full_address}}</p>
                            </div>
                            <div class="col-6">
                                <label class="font-12 text-gray font-weight-light">STATUS</label>
                                <p class="text-white font-16">
                                    {{product.status}}
                                </p>
                            </div>
                            <div class="col-6 border-right border-secondary">
                                <label class="font-12 text-gray font-weight-light">START DATE</label>
                                <p class="text-white font-16 mb-0">{{product.start_date}}</p>
                            </div>
                            <div class="col-6">
                                <label class="font-12 text-gray font-weight-light">END DATE</label>
                                <p class="text-white font-16 mb-0">{{product.end_date}}</p>
                            </div>
                            {% if investment_product.plan_file_name %}
                            <div class="col-12">
                                <label class="mt-3 font-12 text-gray font-weight-light">INVESTMENT PLAN</label>
                                <a href="{{product.plan_file_url}}">
                                    <p class="text-white font-16">{{product.plan_file_name}}</p>
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <label class="font-12 text-gray font-weight-light">DESCRIPTION</label>
                        <p class="text-white font-16 mb-0">{{product.description|safe}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- TODO: Investment Product 정보 추가-->
    <div class="col-12">
        <p class="text-white font-16">
            CONSTRUCTIONS
        </p>
    </div>
    <div class="col-12 mb-3">
        <table class="table table-condensed dataTable w-100">
            <colgroup>
                <col width="">
                <col width="">
                <col width="">
                <col width="">
                <col width="">
                <col width="">
            </colgroup>
            <thead class="thead-dark">
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Budget</th>
                  <th>Period / End Date</th>
                  <th></th>
                </tr>
            </thead>
            <tbody>
                {% for construction in constructions %}
                <tr>
                    <td>{{construction.id}}</td>
                    <td>{{construction.title}}</td>
                    <td>{{construction.status}}</td>
                    <td class="dollar_sign">{{construction.budget}}</td>
                    <td>{{construction.period}}weeks / {{construction.end_date|date:"N j. Y"}}</td>
                    <td>
                        <a class="btn btn-sm btn-link text-danger"
                           href="{% url 'administrator:product-delete' product.id %}">
                              <i class="dripicons-trash"></i> DELETE
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}

{% block modal %}
<!-- All Products (select products to add) -->
<div class="modal fade" id="all_products_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Products to Add</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-condensed dataTable w-100">
                    <colgroup>
                        <col width="">
                        <col width="">
                        <col width="">
                    </colgroup>
                    <thead class="thead-dark">
                        <tr>
                          <th>Code</th>
                          <th>Address</th>
                          <th>Investment Product</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in connectable_products %}
                        <tr>
                            <td>{{product.code}}</td>
                            <td>{{product.full_address}}</td>
                            <td>
                                {% if product.investment_product %}
                                <a href="{% url 'administrator:investment-product-detail' product.investment_product.id %}">
                                    <i class="dripicons-link"></i>
                                    {{product.investment_product.title}}
                                </a>
                                {% else %}
                                <a class="text-success"
                                  href="{% url 'administrator:investment-product-add-product' investment_product_id=investment_product.id product_id=product.id %}">
                                      <i class="dripicons-plus"></i> ADD
                                </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td class="text-center" colspan="100%">No Products</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- All Users (select users to add) -->
<div class="modal fade" id="all_users_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Users to Add</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-condensed dataTable w-100">
                    <colgroup>
                        <col width="">
                        <col width="">
                        <col width="">
                    </colgroup>
                    <thead class="thead-dark">
                        <tr>
                          <th>Name</th>
                          <th>Email</th>
                          <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in investable_users %}
                        <tr>
                            <td>{{user.name}}</td>
                            <td>{{user.email}}</td>
                            <td>
                                <a class="text-success"
                                   href="{% url 'administrator:investment-create' investment_product_id=investment_product.id user_id=user.id %}">
                                      <i class="dripicons-plus"></i> ADD
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td class="text-center" colspan="100%">No Users</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div class="modal fade" id="product_img_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_img_title">Image Title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body modal_inner_img_full">
                <img id="modal_img_content" class="d-block img-fluid" alt="Image" width="100%">
            </div>
        </div>
    </div>
</div>
<script>
function changeModalImage(title, src) {
    document.getElementById("modal_img_title").innerHTML = title;
    document.getElementById("modal_img_content").src = src;
}
</script>
{% endblock modal %}

{% block third_party %}
{% include "base/load_datatable.html" %}
{% endblock third_party %}
