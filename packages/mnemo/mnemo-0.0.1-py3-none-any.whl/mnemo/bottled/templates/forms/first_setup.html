<!-- FIRST SETUP FORM -->
<div class="container">
    <h1 class="main-title">Welcome to Mnemo!</h1>
    <p><small>This is your first setup!</small></p>

    <form id="first-setup" action="first_setup" method="post">
        <!-- EMAIL -->
        <div class="row form-group">
            <div class="col-6">
                <label for="user_email">Email address</label>
                <input type="email" class="form-control" id="user_email" name="user_email"
                    aria-describedby="emailHelpBlock" required />
            </div>
            <div class="col-6">
                <label for="email_confirmation">Confirm your email address</label>
                <input type="email" class="form-control" id="email_confirmation" required />
            </div>
            <small id="emailHelpBlock" class="form-text text-muted">
                Your email is never shared.
            </small>
        </div>

        <!-- PASSWORD -->
        <div class="row form-group">
            <div class="col-6">
                <label for="user_password">Password</label>
                <input type="password" class="form-control" id="user_password" name="user_password"
                    aria-describedby="passwordHelpBlock" required />
            </div>
            <div class="col-6">
                <label for="password_confirmation">Confirm your new password</label>
                <input type="password" class="form-control" id="password_confirmation" required />
            </div>
            <small id="passwordHelpBlock" class="form-text text-muted">
                Your password must be 8-20 characters long, contain letters and numbers, and must not contain spaces,
                special characters, or emoji.
            </small>
        </div>
        <button type="submit" class="btn btn-primary disabled">Submit</button>
    </form>

    <script type="text/javascript">
        function isEmail(email) {
            var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return regex.test(email);
        }

        validate_email = function () {
            email1 = $("#user_email").val();
            email2 = $("#email_confirmation").val();

            validated = email1 == email2 && isEmail(email1) && isEmail(email2)

            if (validated) {
                $("form#first-setup input[type=email]").addClass("is-valid");
                $("form#first-setup input[type=email]").removeClass("is-invalid");
            } else {
                $("form#first-setup input[type=email]").removeClass("is-valid");
                $("form#first-setup input[type=email]").addClass("is-invalid");
            }

            return validated
        }

        validate_password = function () {
            pwd1 = $("#user_password").val();
            pwd2 = $("#password_confirmation").val();

            validated = pwd1 == pwd2 && pwd1.length >= 8 && pwd1.length <= 20;

            if (validated) {
                $("form#first-setup input[type=password]").addClass("is-valid");
                $("form#first-setup input[type=password]").removeClass("is-invalid");
            } else {
                $("form#first-setup input[type=password]").removeClass("is-valid");
                $("form#first-setup input[type=password]").addClass("is-invalid");
            }

            return validated
        }

        validate_form = function () {
            email_validated = validate_email();
            password_validated = validate_password();
            if (email_validated && password_validated) {
                $("form#first-setup button[type=submit]").removeClass("disabled");
            } else {
                $("form#first-setup button[type=submit]").addClass("disabled");
            }
            return email_validated && password_validated
        }

        $(function () {
            $("#user_email").keyup(validate_form);
            $("#email_confirmation").keyup(validate_form);
            $("#user_password").keyup(validate_form);
            $("#password_confirmation").keyup(validate_form);

            $("form#first-setup").submit(function (e) {
                if (validate_form() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    event.preventDefault();
                    $.post('/first_setup', $(this).serialize(), function (data) {
                        console.log(data);
                        if (data['success'] === true) {
                            location.reload();
                        }
                    },
                        'json'
                    );
                }
            });
        });

    </script>
</div>